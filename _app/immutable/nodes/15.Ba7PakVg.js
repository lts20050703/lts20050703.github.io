import{f,a as i,c as _e,t as Ye}from"../chunks/D2Os11Ns.js";import{p as Ze,u as Fe,b as De,g as e,d as C,f as K,s as r,c as t,t as S,a as et,r as a,k as Je,i as n,l as tt,m as Oe,o as Te}from"../chunks/CdrH6FGe.js";import{d as at,s as y}from"../chunks/D32HDFMs.js";import{i as A}from"../chunks/C_8Ez5C7.js";import{e as Ce,i as Ae}from"../chunks/Dh-GaU7P.js";import{d as rt,n as Ee,r as se,s as X,v as ot}from"../chunks/B2cvRHtJ.js";import{b as he,c as Me}from"../chunks/C-DQbPxC.js";import{b as st}from"../chunks/DG713H4s.js";import{b as lt}from"../chunks/mG4M-Ku5.js";import{H as it}from"../chunks/D0zFscOs.js";import{x as qe,a as nt,b as vt,e as dt,p as ct,c as _t,d as ut,i as m,M as Ge,f as pt}from"../chunks/D4tuo3Se.js";import{t as Y,T as bt}from"../chunks/D7WT8dLS.js";import{l as ft,s as b,a as ke,b as _,c as mt}from"../chunks/Nrqgik9B.js";var gt=f('<button class="btn btn-sm btn-primary"> </button>'),yt=f('<input class="input input-sm input-primary"/>'),xt=f('<div class="font-bold"> </div>'),wt=f('<div class="flex flex-row items-center justify-between gap-4"><!> <button class="btn btn-sm"><!></button></div>'),ht=f('<div class="font-bold"> </div>'),kt=f("<div> </div>"),St=f("<div> <!></div>"),$t=f("<div> </div>"),It=f("<div></div>"),jt=f("<!> <!> <div> </div> <div> </div> <div> </div>",1),Nt=f('<hr class="my-2 w-full opacity-25"/> <div class="text-error"> </div>',1),Ft=f('<!> <hr class="my-2 w-full opacity-25"/> <div class="bg-base-100 p-4"><div class="flex flex-col border p-4"><!></div></div> <hr class="my-2 w-full opacity-25"/> <div class="mt-4 flex flex-col items-center justify-center gap-1"><button class="btn btn-sm btn-primary"> </button> <div class="mt-4 flex flex-row gap-1"><input class="input input-sm input-primary" type="text"/> <button class="btn px-1 btn-sm btn-error"><!></button></div> <button class="btn btn-sm btn-error"> </button></div> <!> <hr class="my-2 w-full opacity-25"/> <div class="tabs-lift tabs w-full"><input type="radio" name="section" class="tab border-b-0! [--tab-border-color:--color-base-content]"/> <div class="tab-content border-base-content bg-base-100 p-4"><div class="flex flex-col items-center justify-center gap-1"><!> <hr class="my-2 w-full opacity-25"/> <!> <hr class="my-2 w-full opacity-25"/> <!></div></div> <input type="radio" name="section" class="tab border-b-0! [--tab-border-color:--color-base-content]"/> <div class="tab-content border-base-content bg-base-100 p-4"><div class="flex flex-col items-center justify-center gap-1"><!></div></div></div> <!>',1),Dt=f('<div class="flex flex-col border p-4"><!> <hr class="my-2 w-full opacity-25"/> <button class="btn mt-2 w-full btn-primary">Load</button> <hr class="my-2 w-full opacity-25"/> <div class="flex flex-row gap-1"><button class="btn grow btn-sm btn-error">Delete</button> <button class="btn btn-sm"> </button></div></div>'),Jt=f("<option> </option>"),Ot=f('<div class="mt-4 flex flex-row gap-1"><input class="input input-sm grow input-primary" type="text"/> <button class="btn px-1 btn-sm btn-error"><!></button></div>'),Tt=f('<div class="mt-4 flex flex-col gap-4"><select class="select w-full select-primary"><option>Use Default Config</option><!><option>Import save file</option></select> <!> <div class="flex flex-col gap-1"><!></div></div>'),Ct=f('<button class="btn btn-primary">New Game</button>'),At=f('<button class="btn btn-error">Delete</button>'),Et=f('<div class="relative mt-8 w-full"><div class="flex justify-center"><div class="absolute -top-5 rounded bg-base-100 px-4 pt-4"><div class="rounded border px-4 pb-1 text-3xl font-bold">SAVE DATA</div></div></div> <div class="flex w-full flex-col gap-4 rounded bg-base-100 p-4"><div class="flex flex-col-reverse gap-4 rounded border p-4 pt-10"><!> <div><button class="btn w-full btn-primary">New Game</button></div></div></div></div> <!> <!>',1),Mt=f('<!> <div class="text-center text-2xl font-bold"> </div> <div class="text-center text-2xl font-bold"> </div> <div class="text-center"> </div> <div class="m-1 flex items-center justify-center"><div class="flex w-full max-w-sm flex-col items-center justify-center gap-1"><!> <!></div></div> <!>',1);function Xt(He,Le){Ze(Le,!0);const Se=[],Ue=x=>{var o=gt();o.__click=()=>{if(e(I)===-1)return console.warn("No file to save");const w=_[e(I)];w.time=b.time,w.day=b.day,w.night=b.night,w.current_role=b.current_role,w.roles=b.roles,w.players=b.players.map(L=>L.name),localStorage.setItem("werewolf-moderator.slots",JSON.stringify(_)),n(I,-1),n(V,"loading")};var k=t(o,!0);a(o),S(()=>y(k,m.save_and_quit)),i(x,o)},le=(x,o=Je,k=Je,w,L)=>{let Z=Oe(()=>Te(w?.(),!0)),B=Oe(()=>Te(L?.(),!0));var U=_e(),ee=K(U);{var R=$=>{var N=jt(),c=K(N);{var u=s=>{var l=wt(),v=t(l);{var z=q=>{var T=yt();se(T),T.__change=()=>{localStorage.setItem("werewolf-moderator.slots",JSON.stringify(_))},S(()=>X(T,"placeholder",`File #${k()+1}`)),he(T,()=>o().label,oe=>o().label=oe),i(q,T)},M=q=>{var T=xt(),oe=t(T,!0);a(T),S(()=>y(oe,o().label||`File #${k()+1}`)),i(q,T)};A(v,q=>{e(pe)?q(z):q(M,!1)})}var g=r(v,2);g.__click=()=>{n(pe,!e(pe))};var P=t(g);pt(P,()=>"size-4"),a(g),a(l),i(s,l)},d=s=>{var l=ht(),v=t(l,!0);a(l),S(()=>y(v,o().label||`File #${k()+1}`)),i(s,l)};A(c,s=>{e(Z)?s(u):s(d,!1)})}var p=r(c,2);{var J=s=>{var l=_e(),v=K(l);{var z=g=>{var P=kt(),q=t(P,!0);a(P),S(()=>y(q,m.setup)),i(g,P)},M=g=>{var P=_e(),q=K(P);{var T=te=>{var ae=St(),ce=t(ae),xe=r(ce);{var we=G=>{var Q=Ye();S(()=>y(Q,`(${m.role_names[o().current_role]??""})`)),i(G,Q)};A(xe,G=>{o().current_role&&G(we)})}a(ae),S(()=>y(ce,`${m.night??""} #${o().night??""} `)),i(te,ae)},oe=te=>{var ae=_e(),ce=K(ae);{var xe=G=>{var Q=$t(),Xe=t(Q);a(Q),S(()=>y(Xe,`${m.day??""} #${o().day??""}`)),i(G,Q)},we=G=>{var Q=It();i(G,Q)};A(ce,G=>{o().time==="day"?G(xe):G(we,!1)},!0)}i(te,ae)};A(q,te=>{o().time==="night"?te(T):te(oe,!1)},!0)}i(g,P)};A(v,g=>{o().time==="setup"?g(z):g(M,!1)})}i(s,l)};A(p,s=>{e(B)&&s(J)})}var h=r(p,2),F=t(h);a(h);var E=r(h,2),D=t(E);a(E);var W=r(E,2),O=t(W);a(W),S((s,l,v)=>{y(F,`Deck: ${s??""}`),y(D,`${m.roles??""}: ${l??""}`),y(O,`${m.player??""}: ${v??""}`)},[()=>o().deck.map(s=>m[s]).join(", "),()=>o().roles.map(s=>m.role_names[s]).join(", "),()=>o().players.join(", ")]),i($,N)};A(ee,$=>{o()&&$(R)})}i(x,U)};let ie=C(void 0),V=C("loading"),ue=C(void 0),ne=C("players"),ve=C(void 0),re=C(-1),de=C(void 0),H=C(-1),pe=C(!1),j=C(""),I=C(-1);Fe(()=>{De(()=>{ft(localStorage.getItem("werewolf-moderator.slots"))})}),Fe(()=>{e(V)!=="loaded"||e(I)===-1||(localStorage.setItem(`werewolf-moderator[${e(I)}]`,JSON.stringify(b)),De(()=>Y("Autosaved!","success",1e3)))});function be(x){e(j)===""||x instanceof KeyboardEvent&&x.key!=="Enter"||(localStorage.setItem("werewolf-moderator",e(j)),location.reload())}var $e=Mt(),Ie=K($e);it(Ie,{get title(){return Ee.msn},get description(){return rt.msn},uri:"msn/debug"});var fe=r(Ie,2),ze=t(fe,!0);a(fe);var me=r(fe,2),Ke=t(me,!0);a(me);var ge=r(me,2),Ve=t(ge,!0);a(ge);var ye=r(ge,2),je=t(ye),Ne=t(je);{var Be=x=>{var o=Nt(),k=r(K(o),2),w=t(k,!0);a(k),S(()=>y(w,e(ue))),i(x,o)};A(Ne,x=>{e(ue)&&x(Be)})}var Pe=r(Ne,2);{var Qe=x=>{var o=Ft(),k=K(o);Ue(k);var w=r(k,4),L=t(w),Z=t(L);le(Z,()=>_[e(I)],()=>e(I),()=>!1),a(L),a(w);var B=r(w,4),U=t(B);U.__pointerup=async()=>{try{navigator.clipboard.writeText(localStorage.getItem(`werewolf-moderator[${e(I)}]`)??""),Y("Copied to clipboard!","success",3e3)}catch{Y("Failed to copy to clipboard! The save state has been put into the input below, so you can copy it manually.","error",15e3),n(j,localStorage.getItem(`werewolf-moderator[${e(I)}]`)??"",!0),await tt(),e(ie)?.focus(),e(ie)?.select()}};var ee=t(U,!0);a(U);var R=r(U,2),$=t(R);se($),$.__keydown=be,lt($,g=>n(ie,g),()=>e(ie));var N=r($,2);N.__click=()=>{n(j,"")};var c=t(N);qe(c),a(N),a(R);var u=r(R,2);u.__click=be;var d=t(u,!0);a(u),a(B);var p=r(B,2);nt(p);var J=r(p,4),h=t(J);se(h),h.value=h.__value="players";var F=r(h,2),E=t(F),D=t(E);vt(D);var W=r(D,4);dt(W);var O=r(W,4);ct(O),a(E),a(F);var s=r(F,2);se(s),s.value=s.__value="roles";var l=r(s,2),v=t(l),z=t(v);_t(z),a(v),a(l),a(J);var M=r(J,2);ut(M),S(()=>{y(ee,m.copy_save_state_to_clipboard),X($,"placeholder",m.save_state),N.disabled=!e(j),X(N,"aria-label",m.clear),u.disabled=!e(j),y(d,m.import_save_state),X(h,"aria-label",m.players),X(s,"aria-label",m.roles)}),he($,()=>e(j),g=>n(j,g)),Me(Se,[],h,()=>e(ne),g=>n(ne,g)),Me(Se,[],s,()=>e(ne),g=>n(ne,g)),i(x,o)},Re=x=>{var o=Et(),k=K(o),w=r(t(k),2),L=t(w),Z=t(L);Ce(Z,17,()=>_,Ae,($,N,c)=>{var u=Dt(),d=t(u);le(d,()=>e(N),()=>c);var p=r(d,4);p.__click=()=>{n(I,c,!0),n(V,"loading");try{n(V,ke(localStorage.getItem(`werewolf-moderator[${e(I)}]`),!0),!0),Y("Loaded save!","success",3e3)}catch(D){Y("Failed to load save!","error",3e3),n(ue,D,!0)}};var J=r(p,4),h=t(J);h.__click=()=>{e(ve)?.showModal(),n(re,c,!0)};var F=r(h,2);F.__pointerup=async()=>{try{const D=localStorage.getItem(`werewolf-moderator[${c}]`);if(!D)throw new Error("Save not found");navigator.clipboard.writeText(D),Y("Copied to clipboard!","success",3e3)}catch{Y("Failed to copy to clipboard!","error",15e3)}};var E=t(F,!0);a(F),a(J),a(u),S(()=>y(E,m.copy_save_state_to_clipboard)),i($,u)});var B=r(Z,2),U=t(B);U.__click=()=>{n(H,-1),e(de)?.showModal()},a(B),a(L),a(w),a(k);var ee=r(k,2);Ge(ee,{title:"New Game Config",get modal(){return e(de)},set modal(c){n(de,c,!0)},body:c=>{var u=Tt(),d=t(u),p=t(d);p.value=p.__value=-1;var J=r(p);Ce(J,17,()=>({length:_.length}),Ae,(O,s,l)=>{var v=Jt(),z=t(v);a(v);var M={};S(()=>{y(z,`Use ${(_[_.length-l-1].label||`File #${_.length-l}`)??""}'s Config`),M!==(M=_.length-l-1)&&(v.value=v.__value=_.length-l-1)}),i(O,v)});var h=r(J);h.value=h.__value=-2,a(d);var F=r(d,2);{var E=O=>{var s=Ot(),l=t(s);se(l);var v=r(l,2);v.__click=()=>{n(j,"")};var z=t(v);qe(z),a(v),a(s),S(()=>{X(l,"placeholder",m.save_state),v.disabled=!e(j),X(v,"aria-label",m.clear)}),he(l,()=>e(j),M=>n(j,M)),i(O,s)};A(F,O=>{e(H)===-2&&O(E)})}var D=r(F,2),W=t(D);le(W,()=>_[e(H)],()=>e(H),()=>!1,()=>!1),a(D),a(u),st(d,()=>e(H),O=>n(H,O)),i(c,u)},buttons:c=>{var u=Ct();u.__click=()=>{if(n(I,_.length,!0),n(V,"loading"),e(H)===-2)be(),_.push({label:"",time:b.time,deck:b.deck,roles:b.roles,players:b.players.map(d=>d.name),night:b.night,current_role:b.current_role,day:b.day});else if(e(H)===-1)n(V,ke("{}"),!0),_.push({label:"",time:"setup",deck:["msn25","msn24","ultimate"],day:0,night:0,current_role:void 0,roles:["werewolf","villager"],players:["1","2"]});else{const d=mt.parse(JSON.parse(localStorage.getItem(`werewolf-moderator[${e(H)+1}]`)??"{}"));ke("{}"),b.deck=d.deck,b.roles=d.roles,b.players=d.players.map(p=>({id:p.id,name:p.name,alive:!0,role:void 0,score:0})),_.push({label:"",time:"setup",deck:b.deck,roles:b.roles,players:b.players.map(p=>p.name),night:0,current_role:void 0,day:0})}localStorage.setItem("werewolf-moderator.slots",JSON.stringify(_)),e(de)?.close()},i(c,u)},$$slots:{body:!0,buttons:!0}});var R=r(ee,2);Ge(R,{title:"Delete?",get modal(){return e(ve)},set modal(c){n(ve,c,!0)},body:c=>{le(c,()=>_[e(re)],()=>e(re),()=>!1)},buttons:c=>{var u=At();u.__click=()=>{for(let d=e(re);d<_.length-1;d+=1){const p=localStorage.getItem(`werewolf-moderator[${d+1}]`);p&&localStorage.setItem(`werewolf-moderator[${d}]`,p)}_.splice(e(re),1),localStorage.setItem("werewolf-moderator.slots",JSON.stringify(_)),e(ve)?.close(),n(I,-1),n(V,"loading")},i(c,u)},$$slots:{body:!0,buttons:!0}}),i(x,o)};A(Pe,x=>{e(V)==="loaded"?x(Qe):x(Re,!1)})}a(je),a(ye);var We=r(ye,2);bt(We,{}),S(()=>{y(ze,Ee.msn),y(Ke,m.debug),y(Ve,ot["werewolf-moderator"])}),i(He,$e),et()}at(["click","change","pointerup","keydown"]);export{Xt as component};
