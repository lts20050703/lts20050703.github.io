import{f as _,a as i,c as ce,t as it}from"../chunks/D2Os11Ns.js";import{p as Ye,s as a,f as N,c as o,r,t as x,g as t,h as Je,a as et,u as He,b as Te,i as f,d as Q,k as Ee,m as Ue,o as Ve}from"../chunks/CdrH6FGe.js";import{d as tt,s as y,e as Ze}from"../chunks/D32HDFMs.js";import{i as D}from"../chunks/C_8Ez5C7.js";import{e as qe,i as Be}from"../chunks/Dh-GaU7P.js";import{r as $e,s as oe,d as nt,n as Ke,v as dt}from"../chunks/Bq6p_3ih.js";import{b as ze,c as Pe}from"../chunks/C-DQbPxC.js";import{b as vt}from"../chunks/DG713H4s.js";import{r as ct}from"../chunks/DsDL3Kke.js";import{H as _t}from"../chunks/IkyKfH6i.js";import{L as ut}from"../chunks/DOUyAul8.js";import{b as at,c as rt,d as ot,i as b,h as mt,x as st,M as Qe,a as ft,e as pt,p as bt,f as gt}from"../chunks/Ctd2im35.js";import{t as Ie,T as yt}from"../chunks/D7WT8dLS.js";import{s as e,n as wt,l as xt,c as Re,a as xe,b as p,d as ht,A as kt,e as St}from"../chunks/Nrqgik9B.js";import{N as It,D as $t}from"../chunks/Dyw-1MN0.js";import{a as We,d as jt,f as Nt,b as Dt}from"../chunks/0Vtho8RT.js";import{s as Xe}from"../chunks/B7jqvjGK.js";import{a as Ot}from"../chunks/DxFkQ900.js";var Jt=_('<div class="col-span-full grid grid-cols-subgrid gap-1"><div class="h-6 w-6"><!></div> <input type="text"/> <button class="btn px-1 btn-sm btn-error"><!></button></div>'),At=_('<div class="grid grid-cols-[auto_1fr_auto] items-center justify-center gap-1 rounded border border-primary p-1"><div></div> <div class="text-center"> </div> <div></div> <section class="col-span-full grid grid-cols-subgrid gap-1"></section></div>'),Ft=_('<hr class="my-2 w-full opacity-25"/> <div> </div> <!> <hr class="my-2 w-full opacity-25"/> <!> <hr class="my-2 w-full opacity-25"/> <div class="text-center text-3xl"> </div> <!> <!> <button class="btn btn-primary"> </button>',1);function Lt(Ae,Fe){Ye(Fe,!0);const he=300,_e=Je(()=>e.players.some(K=>e.players.some(R=>K.id!==R.id&&K.name===R.name))),ue=Je(()=>e.players.some(K=>!K.name));var B=Ft(),A=a(N(B),2),me=o(A,!0);r(A);var je=a(A,2);at(je);var Ne=a(je,4);{var $=K=>{var R=At(),pe=a(o(R),2),ke=o(pe,!0);r(pe);var le=a(pe,4);qe(le,31,()=>e.players,j=>j.id,(j,W,De)=>{var ie=Jt(),ne=o(ie),Le=o(ne);mt(Le),r(ne),We(ne,s=>jt?.(s));var de=a(ne,2);$e(de);var te=a(de,2);te.__click=()=>{const s=e.players.indexOf(t(W));s!==-1&&e.players.splice(s,1)};var Me=o(te);st(Me),r(te),r(ie),x(s=>{Xe(de,1,`input input-sm ${s??""}`),oe(de,"placeholder",`${b.player_name??""}...`),te.disabled=e.players.length<=2,oe(te,"aria-label",b.remove_player)},[()=>!t(W).name||e.players.some((s,l)=>l!==t(De)&&s.name===t(W).name)?"input-warning":"input-primary"]),ze(de,()=>t(W).name,s=>t(W).name=s),Ot(ie,()=>Nt,()=>({duration:he})),i(j,ie)}),r(le),We(le,(j,W)=>Dt?.(j,W),()=>({items:e.players,flipDurationMs:he,transformDraggedElement:j=>{j?.classList.remove("grid-cols-subgrid"),j?.classList.add("grid","grid-cols-[auto_1fr_auto]")}})),r(R),x(()=>y(ke,b.player_name)),Ze("consider",le,j=>{e.players=j.detail.items}),Ze("finalize",le,j=>{e.players=j.detail.items}),i(K,R)};D(Ne,K=>{e.players.length&&K($)})}var X=a(Ne,4),se=o(X,!0);r(X);var fe=a(X,2);rt(fe);var T=a(fe,2);ot(T);var Y=a(T,2);Y.__click=()=>{e.time="night",e.night===0?wt():e.current_role?e.time="night":e.time="day"};var ee=o(Y,!0);r(Y),x(()=>{Xe(A,1,`text-3xl ${t(_e)||t(ue)?"text-warning":"text-success"}`),y(me,b.players),y(se,b.roles),Y.disabled=t(_e)||t(ue),y(ee,b.start)}),i(Ae,B),et()}tt(["click"]);var Mt=_('<button class="btn btn-sm btn-primary"> </button>'),Ct=_('<input class="input input-sm input-primary"/>'),Gt=_('<div class="font-bold"> </div>'),Ht=_('<div class="flex flex-row items-center justify-between gap-4"><!> <button class="btn btn-sm"><!></button></div>'),Tt=_('<div class="font-bold"> </div>'),qt=_("<div> </div>"),zt=_("<div> <!></div>"),Et=_("<div> </div>"),Ut=_("<div></div>"),Vt=_("<!> <!> <div> </div> <div> </div> <div> </div>",1),Zt=_('<button class="btn btn-sm"> </button> <!> <hr class="my-2 w-full opacity-25"/> <div class="tabs-lift tabs w-full"><input type="radio" name="section" class="tab border-b-0! [--tab-border-color:--color-base-content]"/> <div class="tab-content border-base-content bg-base-100 p-4"><div class="flex flex-col items-center justify-center gap-1"><!> <hr class="my-2 w-full opacity-25"/> <!> <hr class="my-2 w-full opacity-25"/> <!></div></div> <input type="radio" name="section" class="tab border-b-0! [--tab-border-color:--color-base-content]"/> <div class="tab-content border-base-content bg-base-100 p-4"><div class="flex flex-col items-center justify-center gap-1"><!></div></div></div> <!> <!>',1),Bt=_("<!> <!>",1),Kt=_('<div class="flex w-full flex-row justify-between"><button class="btn btn-sm"> </button> <button class="btn btn-sm"> </button></div> <!>',1),Pt=_('<div class="flex w-full flex-row justify-between"><button class="btn btn-sm"> </button> <button class="btn btn-sm"> </button></div> <!> <hr class="my-2 w-full opacity-25"/> <!>',1),Qt=_(`<div class="fixed bottom-4 z-50 flex w-full flex-col items-center justify-center gap-1 p-1 text-center"><div>If Link ask you to export save state (or you know how to manually update the save file
						to the latest version), click the link below</div> <a class="link link-primary underline-offset-8">Go to debug page</a></div>`),Rt=_("<!> <!> <!>",1),Wt=_('<div class="flex flex-col border p-4"><!> <hr class="my-2 w-full opacity-25"/> <button class="btn mt-2 w-full btn-primary">Load</button> <hr class="my-2 w-full opacity-25"/> <div class="flex flex-row gap-1"><button class="btn grow btn-sm btn-error">Delete</button> <button class="btn btn-sm"> </button></div></div>'),Xt=_("<option> </option>"),Yt=_('<div class="mt-4 flex flex-row gap-1"><input class="input input-sm grow input-primary" type="text"/> <button class="btn px-1 btn-sm btn-error"><!></button></div>'),ea=_('<div class="mt-4 flex flex-col gap-4"><select class="select w-full select-primary"><option>Use Default Config</option><!><option>Import save file</option></select> <!> <div class="flex flex-col gap-1"><!></div></div>'),ta=_('<button class="btn btn-primary">New Game</button>'),aa=_('<button class="btn btn-error">Delete</button>'),ra=_('<div class="relative mt-8 w-full"><div class="flex justify-center"><div class="absolute -top-5 rounded bg-base-100 px-4 pt-4"><div class="rounded border px-4 pb-1 text-3xl font-bold">SAVE DATA</div></div></div> <div class="flex w-full flex-col gap-4 rounded bg-base-100 p-4"><div class="flex flex-col-reverse gap-4 rounded border p-4 pt-10"><!> <div><button class="btn w-full btn-primary">New Game</button></div></div></div></div> <!> <!>',1),oa=_('<!> <div class="text-center text-2xl font-bold"> </div> <div class="text-center"> </div> <div class="m-1 mb-12 flex items-center justify-center"><div class="flex w-full max-w-sm flex-col items-center justify-center gap-1"><!> <!> <!></div></div>',1);function ka(Ae,Fe){Ye(Fe,!0);const he=[],_e=s=>{var l=Mt();l.__click=()=>{if(t($)===-1)return console.warn("No file to save");const C=p[t($)];C.time=e.time,C.day=e.day,C.night=e.night,C.current_role=e.current_role,C.roles=e.roles,C.players=e.players.map(ae=>ae.name),localStorage.setItem("werewolf-moderator.slots",JSON.stringify(p)),f($,-1)};var S=o(l,!0);r(l),x(()=>y(S,b.save_and_quit)),i(s,l)},ue=(s,l=Ee,S=Ee,C,ae)=>{let ve=Ue(()=>Ve(C?.(),!0)),be=Ue(()=>Ve(ae?.(),!0));var ge=ce(),O=N(ge);{var G=I=>{var q=Vt(),g=N(q);{var u=v=>{var d=Ht(),c=o(d);{var H=U=>{var Z=Ct();$e(Z),Z.__change=()=>{localStorage.setItem("werewolf-moderator.slots",JSON.stringify(p))},x(()=>oe(Z,"placeholder",`File #${S()+1}`)),ze(Z,()=>l().label,Se=>l().label=Se),i(U,Z)},z=U=>{var Z=Gt(),Se=o(Z,!0);r(Z),x(()=>y(Se,l().label||`File #${S()+1}`)),i(U,Z)};D(c,U=>{t(Y)?U(H):U(z,!1)})}var E=a(c,2);E.__click=()=>{f(Y,!t(Y))};var V=o(E);gt(V,()=>"size-4"),r(E),r(d),i(v,d)},n=v=>{var d=Tt(),c=o(d,!0);r(d),x(()=>y(c,l().label||`File #${S()+1}`)),i(v,d)};D(g,v=>{t(ve)?v(u):v(n,!1)})}var m=a(g,2);{var F=v=>{var d=ce(),c=N(d);{var H=E=>{var V=qt(),U=o(V,!0);r(V),x(()=>y(U,b.setup)),i(E,V)},z=E=>{var V=ce(),U=N(V);{var Z=ye=>{var we=zt(),Oe=o(we),Ce=a(Oe);{var Ge=P=>{var re=it();x(()=>y(re,`(${b.role_names[l().current_role]??""})`)),i(P,re)};D(Ce,P=>{l().current_role&&P(Ge)})}r(we),x(()=>y(Oe,`${b.night??""} #${l().night??""} `)),i(ye,we)},Se=ye=>{var we=ce(),Oe=N(we);{var Ce=P=>{var re=Et(),lt=o(re);r(re),x(()=>y(lt,`${b.day??""} #${l().day??""}`)),i(P,re)},Ge=P=>{var re=Ut();i(P,re)};D(Oe,P=>{l().time==="day"?P(Ce):P(Ge,!1)},!0)}i(ye,we)};D(U,ye=>{l().time==="night"?ye(Z):ye(Se,!1)},!0)}i(E,V)};D(c,E=>{l().time==="setup"?E(H):E(z,!1)})}i(v,d)};D(m,v=>{t(be)&&v(F)})}var L=a(m,2),h=o(L);r(L);var J=a(L,2),w=o(J);r(J);var M=a(J,2),k=o(M);r(M),x((v,d,c)=>{y(h,`Deck: ${v??""}`),y(w,`${b.roles??""}: ${d??""}`),y(k,`${b.player??""}: ${c??""}`)},[()=>l().deck.map(v=>b[v]).join(", "),()=>l().roles.map(v=>b.role_names[v]).join(", "),()=>l().players.join(", ")]),i(I,q)};D(O,I=>{l()&&I(G)})}i(s,ge)};let B=Q(!1),A=Q("loading"),me=Q("players");const je=Je(()=>e.players.some(s=>e.players.some(l=>s.id!==l.id&&s.name===l.name))),Ne=Je(()=>e.players.some(s=>!s.name));let $=Q(-1),X=Q(void 0),se=Q(-1),fe=Q(void 0),T=Q(-1),Y=Q(!1),ee=Q("");function K(){if(t(ee)==="")return;xe(t(ee))==="loaded"?Ie("Imported save state!","success",3e3):Ie("Failed to import save state!","error",3e3)}He(()=>Te(()=>{f($,parseInt(localStorage.getItem("werewolf-moderator.file")??"-1"),!0),xt(localStorage.getItem("werewolf-moderator.slots"));const s=localStorage.getItem("werewolf-moderator");if(s){const l=Re.parse(JSON.parse(s));xe("{}"),e.deck=l.deck,e.roles=l.roles,e.players=l.players.map(S=>({id:S.id,name:S.name,alive:!0,role:void 0,score:0})),p.push({label:"",time:"setup",deck:e.deck,roles:e.roles,players:e.players.map(S=>S.name),night:0,current_role:void 0,day:0}),localStorage.setItem("werewolf-moderator.slots",JSON.stringify(p)),f(B,!1),localStorage.setItem(`werewolf-moderator[${p.length-1}]`,s),localStorage.removeItem("werewolf-moderator")}})),He(()=>{t(A)!=="loaded"||t($)===-1||(localStorage.setItem(`werewolf-moderator[${t($)}]`,ht(e)),Te(()=>Ie("Autosaved!","success",1e3)))}),He(()=>{t($)!==-1?(localStorage.setItem("werewolf-moderator.file",t($).toString()),f(A,xe(localStorage.getItem(`werewolf-moderator[${t($)}]`)),!0),Te(()=>{const s=p[t($)];s&&(s.time=e.time,s.day=e.day,s.night=e.night,s.current_role=e.current_role,s.roles=e.roles,s.players=e.players.map(l=>l.name),localStorage.setItem("werewolf-moderator.slots",JSON.stringify(p)))})):(localStorage.removeItem("werewolf-moderator.file"),f(A,"loaded"))});var R=oa(),pe=N(R);_t(pe,{get title(){return Ke["werewolf-moderator"]},get description(){return nt["werewolf-moderator"]},uri:"werewolf-moderator"});var ke=a(pe,2),le=o(ke,!0);r(ke);var j=a(ke,2),W=o(j,!0);r(j);var De=a(j,2),ie=o(De),ne=o(ie);{var Le=s=>{var l=Rt(),S=N(l);{var C=O=>{var G=Zt(),I=N(G);I.__click=()=>{f(B,!1)};var q=o(I,!0);r(I);var g=a(I,2);ft(g);var u=a(g,4),n=o(u);$e(n),n.value=n.__value="players";var m=a(n,2),F=o(m),L=o(F);at(L);var h=a(L,4);pt(h);var J=a(h,4);bt(J),r(F),r(m);var w=a(m,2);$e(w),w.value=w.__value="roles";var M=a(w,2),k=o(M),v=o(k);rt(v),r(k),r(M),r(u);var d=a(u,2);ot(d);var c=a(d,2);_e(c),x(()=>{I.disabled=t(je)||t(Ne),y(q,b.back),oe(n,"aria-label",b.players),oe(w,"aria-label",b.roles)}),Pe(he,[],n,()=>t(me),H=>f(me,H)),Pe(he,[],w,()=>t(me),H=>f(me,H)),i(O,G)},ae=O=>{var G=ce(),I=N(G);{var q=u=>{var n=Bt(),m=N(n);_e(m);var F=a(m,2);Lt(F,{}),i(u,n)},g=u=>{var n=ce(),m=N(n);{var F=h=>{var J=Kt(),w=N(J),M=o(w);M.__click=()=>{e.time="setup"};var k=o(M,!0);r(M);var v=a(M,2);v.__click=()=>{f(B,!0)};var d=o(v,!0);r(v),r(w);var c=a(w,2);It(c,{}),x(()=>{y(k,b.setup),y(d,b.advanced_settings)}),i(h,J)},L=h=>{var J=ce(),w=N(J);{var M=k=>{var v=Pt(),d=N(v),c=o(d);c.__click=()=>{e.time="setup"};var H=o(c,!0);r(c);var z=a(c,2);z.__click=()=>{f(B,!0)};var E=o(z,!0);r(z),r(d);var V=a(d,2);$t(V,{});var U=a(V,4);_e(U),x(()=>{y(H,b.setup),y(E,b.advanced_settings)}),i(k,v)};D(w,k=>{e.time==="day"&&k(M)},!0)}i(h,J)};D(m,h=>{e.time==="night"?h(F):h(L,!1)},!0)}i(u,n)};D(I,u=>{e.time==="setup"?u(q):u(g,!1)},!0)}i(O,G)};D(S,O=>{t(B)?O(C):O(ae,!1)})}var ve=a(S,2);kt(ve,{});var be=a(ve,2);{var ge=O=>{var G=Qt(),I=a(o(G),2);r(G),x(q=>oe(I,"href",q),[()=>ct("/werewolf-moderator/debug/")]),i(O,G)};D(be,O=>{t(A)==="error"&&O(ge)})}i(s,l)},de=s=>{var l=ra(),S=N(l),C=a(o(S),2),ae=o(C),ve=o(ae);qe(ve,17,()=>p,Be,(I,q,g)=>{var u=Wt(),n=o(u);ue(n,()=>t(q),()=>g);var m=a(n,4);m.__click=()=>{f($,g,!0),f(A,"loading"),f(A,xe(localStorage.getItem(`werewolf-moderator[${t($)}]`)),!0),f(B,!1)};var F=a(m,4),L=o(F);L.__click=()=>{t(X)?.showModal(),f(se,g,!0)};var h=a(L,2);h.__pointerup=async()=>{try{const w=localStorage.getItem(`werewolf-moderator[${g+1}]`);if(!w)throw new Error("Save not found");navigator.clipboard.writeText(w),Ie("Copied to clipboard!","success",3e3)}catch{Ie("Failed to copy to clipboard!","error",15e3)}};var J=o(h,!0);r(h),r(F),r(u),x(()=>y(J,b.copy_save_state_to_clipboard)),i(I,u)});var be=a(ve,2),ge=o(be);ge.__click=()=>{f(T,-1),t(fe)?.showModal()},r(be),r(ae),r(C),r(S);var O=a(S,2);Qe(O,{title:"New Game Config",get modal(){return t(fe)},set modal(g){f(fe,g,!0)},body:g=>{var u=ea(),n=o(u),m=o(n);m.value=m.__value=-1;var F=a(m);qe(F,17,()=>({length:p.length}),Be,(k,v,d)=>{var c=Xt(),H=o(c);r(c);var z={};x(()=>{y(H,`Use ${(p[p.length-d-1].label||`File #${p.length-d}`)??""}'s Config`),z!==(z=p.length-d-1)&&(c.value=c.__value=p.length-d-1)}),i(k,c)});var L=a(F);L.value=L.__value=-2,r(n);var h=a(n,2);{var J=k=>{var v=Yt(),d=o(v);$e(d);var c=a(d,2);c.__click=()=>{f(ee,"")};var H=o(c);st(H),r(c),r(v),x(()=>{oe(d,"placeholder",b.save_state),c.disabled=!t(ee),oe(c,"aria-label",b.clear)}),ze(d,()=>t(ee),z=>f(ee,z)),i(k,v)};D(h,k=>{t(T)===-2&&k(J)})}var w=a(h,2),M=o(w);ue(M,()=>p[t(T)],()=>t(T),()=>!1,()=>!1),r(w),r(u),vt(n,()=>t(T),k=>f(T,k)),i(g,u)},buttons:g=>{var u=ta();u.__click=()=>{if(f($,p.length,!0),f(A,"loading"),t(T)===-2)K(),p.push({label:"",time:e.time,deck:e.deck,roles:e.roles,players:e.players.map(n=>n.name),night:e.night,current_role:e.current_role,day:e.day});else if(t(T)===-1)f(A,xe("{}"),!0),p.push({label:"",time:"setup",deck:["msn25","msn24","ultimate"],day:0,night:0,current_role:void 0,roles:["werewolf","villager"],players:["1","2"]});else{const n=Re.parse(JSON.parse(localStorage.getItem(`werewolf-moderator[${t(T)+1}]`)??"{}"));xe("{}"),e.deck=n.deck,e.roles=n.roles,e.players=n.players.map(m=>({id:m.id,name:m.name,alive:!0,role:void 0,score:0})),p.push({label:"",time:"setup",deck:e.deck,roles:e.roles,players:e.players.map(m=>m.name),night:0,current_role:void 0,day:0})}localStorage.setItem("werewolf-moderator.slots",JSON.stringify(p)),f(B,!1)},i(g,u)},$$slots:{body:!0,buttons:!0}});var G=a(O,2);Qe(G,{title:"Delete?",get modal(){return t(X)},set modal(g){f(X,g,!0)},body:g=>{ue(g,()=>p[t(se)],()=>t(se),()=>!1)},buttons:g=>{var u=aa();u.__click=()=>{for(let n=t(se);n<p.length-1;n+=1){const m=localStorage.getItem(`werewolf-moderator[${n+1}]`);m&&localStorage.setItem(`werewolf-moderator[${n}]`,m)}p.splice(t(se),1),localStorage.setItem("werewolf-moderator.slots",JSON.stringify(p)),t(X)?.close()},i(g,u)},$$slots:{body:!0,buttons:!0}}),i(s,l)};D(ne,s=>{t($)!==-1?s(Le):s(de,!1)})}var te=a(ne,2);yt(te,{});var Me=a(te,2);ut(Me,{get status(){return t(A)},get clear_save(){return St}}),r(ie),r(De),x(()=>{y(le,Ke["werewolf-moderator"]),y(W,dt["werewolf-moderator"])}),i(Ae,R),et()}tt(["click","change","pointerup"]);export{ka as component};
