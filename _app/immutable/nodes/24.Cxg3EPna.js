import{f as _,a as l,c as ce,t as lt}from"../chunks/D2Os11Ns.js";import{p as Xe,s as t,f as j,c as o,r,t as x,g as e,h as Ae,a as Ye,u as He,b as Te,i as f,d as P,k as Ee,m as Ue,o as Ve}from"../chunks/CdrH6FGe.js";import{d as et,s as g,e as Ze}from"../chunks/D32HDFMs.js";import{i as N}from"../chunks/C_8Ez5C7.js";import{e as qe,i as Be}from"../chunks/Dh-GaU7P.js";import{r as $e,s as oe,d as it,n as Ke,v as nt}from"../chunks/PO9IuvA8.js";import{b as ze,c as Pe}from"../chunks/C-DQbPxC.js";import{b as vt}from"../chunks/DG713H4s.js";import{r as dt}from"../chunks/BrYugXLR.js";import{H as ct}from"../chunks/Cigh2edi.js";import{L as _t}from"../chunks/DOUyAul8.js";import{b as tt,c as at,d as rt,i as p,h as ut,x as ot,M as Qe,a as mt,e as ft,p as pt,f as bt}from"../chunks/Cq-Pmsgv.js";import{t as Se,T as gt}from"../chunks/D7WT8dLS.js";import{s as a,n as yt,l as wt,d as xt,a as Ie,b as y,A as ht,e as kt,c as St}from"../chunks/Nrqgik9B.js";import{N as It,D as $t}from"../chunks/BfODlWfG.js";import{a as Re,d as jt,f as Nt,b as Dt}from"../chunks/0Vtho8RT.js";import{s as We}from"../chunks/B7jqvjGK.js";import{a as Ot}from"../chunks/DxFkQ900.js";var At=_('<div class="col-span-full grid grid-cols-subgrid gap-1"><div class="h-6 w-6"><!></div> <input type="text"/> <button class="btn px-1 btn-sm btn-error"><!></button></div>'),Ft=_('<div class="grid grid-cols-[auto_1fr_auto] items-center justify-center gap-1 rounded border border-primary p-1"><div></div> <div class="text-center"> </div> <div></div> <section class="col-span-full grid grid-cols-subgrid gap-1"></section></div>'),Jt=_('<hr class="my-2 w-full opacity-25"/> <div> </div> <!> <hr class="my-2 w-full opacity-25"/> <!> <hr class="my-2 w-full opacity-25"/> <div class="text-center text-3xl"> </div> <!> <!> <button class="btn btn-primary"> </button>',1);function Lt(Fe,Je){Xe(Je,!0);const xe=300,_e=Ae(()=>a.players.some(B=>a.players.some(R=>B.id!==R.id&&B.name===R.name))),ue=Ae(()=>a.players.some(B=>!B.name));var Q=Jt(),A=t(j(Q),2),me=o(A,!0);r(A);var je=t(A,2);tt(je);var Ne=t(je,4);{var I=B=>{var R=Ft(),pe=t(o(R),2),he=o(pe,!0);r(pe);var le=t(pe,4);qe(le,31,()=>a.players,$=>$.id,($,W,De)=>{var ie=At(),ne=o(ie),Le=o(ne);ut(Le),r(ne),Re(ne,s=>jt?.(s));var ve=t(ne,2);$e(ve);var te=t(ve,2);te.__click=()=>{const s=a.players.indexOf(e(W));s!==-1&&a.players.splice(s,1)};var Me=o(te);ot(Me),r(te),r(ie),x(s=>{We(ve,1,`input input-sm ${s??""}`),oe(ve,"placeholder",`${p.player_name??""}...`),te.disabled=a.players.length<=2,oe(te,"aria-label",p.remove_player)},[()=>!e(W).name||a.players.some((s,i)=>i!==e(De)&&s.name===e(W).name)?"input-warning":"input-primary"]),ze(ve,()=>e(W).name,s=>e(W).name=s),Ot(ie,()=>Nt,()=>({duration:xe})),l($,ie)}),r(le),Re(le,($,W)=>Dt?.($,W),()=>({items:a.players,flipDurationMs:xe,transformDraggedElement:$=>{$?.classList.remove("grid-cols-subgrid"),$?.classList.add("grid","grid-cols-[auto_1fr_auto]")}})),r(R),x(()=>g(he,p.player_name)),Ze("consider",le,$=>{a.players=$.detail.items}),Ze("finalize",le,$=>{a.players=$.detail.items}),l(B,R)};N(Ne,B=>{a.players.length&&B(I)})}var X=t(Ne,4),se=o(X,!0);r(X);var fe=t(X,2);at(fe);var H=t(fe,2);rt(H);var Y=t(H,2);Y.__click=()=>{a.time="night",a.night===0?yt():a.current_role?a.time="night":a.time="day"};var ee=o(Y,!0);r(Y),x(()=>{We(A,1,`text-3xl ${e(_e)||e(ue)?"text-warning":"text-success"}`),g(me,p.players),g(se,p.roles),Y.disabled=e(_e)||e(ue),g(ee,p.start)}),l(Fe,Q),Ye()}et(["click"]);var Mt=_('<button class="btn btn-sm btn-primary"> </button>'),Ct=_('<input class="input input-sm input-primary"/>'),Gt=_('<div class="font-bold"> </div>'),Ht=_('<div class="flex flex-row items-center justify-between gap-4"><!> <button class="btn btn-sm"><!></button></div>'),Tt=_('<div class="font-bold"> </div>'),qt=_("<div> </div>"),zt=_("<div> <!></div>"),Et=_("<div> </div>"),Ut=_("<div></div>"),Vt=_("<!> <!> <div> </div> <div> </div> <div> </div>",1),Zt=_('<button class="btn btn-sm"> </button> <!> <hr class="my-2 w-full opacity-25"/> <div class="tabs-lift tabs w-full"><input type="radio" name="section" class="tab border-b-0! [--tab-border-color:--color-base-content]"/> <div class="tab-content border-base-content bg-base-100 p-4"><div class="flex flex-col items-center justify-center gap-1"><!> <hr class="my-2 w-full opacity-25"/> <!> <hr class="my-2 w-full opacity-25"/> <!></div></div> <input type="radio" name="section" class="tab border-b-0! [--tab-border-color:--color-base-content]"/> <div class="tab-content border-base-content bg-base-100 p-4"><div class="flex flex-col items-center justify-center gap-1"><!></div></div></div> <!> <!>',1),Bt=_("<!> <!>",1),Kt=_('<div class="flex w-full flex-row justify-between"><button class="btn btn-sm"> </button> <button class="btn btn-sm"> </button></div> <!>',1),Pt=_('<div class="flex w-full flex-row justify-between"><button class="btn btn-sm"> </button> <button class="btn btn-sm"> </button></div> <!> <hr class="my-2 w-full opacity-25"/> <!>',1),Qt=_(`<div class="fixed bottom-4 z-50 flex w-full flex-col items-center justify-center gap-1 p-1 text-center"><div>If Link ask you to export save state (or you know how to manually update the save file
						to the latest version), click the link below</div> <a class="link link-primary underline-offset-8">Go to debug page</a></div>`),Rt=_("<!> <!> <!>",1),Wt=_('<div class="flex flex-col border p-4"><!> <hr class="my-2 w-full opacity-25"/> <button class="btn mt-2 w-full btn-primary">Load</button> <hr class="my-2 w-full opacity-25"/> <div class="flex flex-row gap-1"><button class="btn grow btn-sm btn-error">Delete</button> <button class="btn btn-sm"> </button></div></div>'),Xt=_("<option> </option>"),Yt=_('<div class="mt-4 flex flex-row gap-1"><input class="input input-sm grow input-primary" type="text"/> <button class="btn px-1 btn-sm btn-error"><!></button></div>'),ea=_('<div class="mt-4 flex flex-col gap-4"><select class="select w-full select-primary"><option>Use Default Config</option><!><option>Import save file</option></select> <!> <div class="flex flex-col gap-1"><!></div></div>'),ta=_('<button class="btn btn-primary">New Game</button>'),aa=_('<button class="btn btn-error">Delete</button>'),ra=_('<div class="relative mt-8 w-full"><div class="flex justify-center"><div class="absolute -top-5 rounded bg-base-100 px-4 pt-4"><div class="rounded border px-4 pb-1 text-3xl font-bold">SAVE DATA</div></div></div> <div class="flex w-full flex-col gap-4 rounded bg-base-100 p-4"><div class="flex flex-col-reverse gap-4 rounded border p-4 pt-10"><!> <div><button class="btn w-full btn-primary">New Game</button></div></div></div></div> <!> <!>',1),oa=_('<!> <div class="text-center text-2xl font-bold"> </div> <div class="text-center"> </div> <div class="m-1 mb-12 flex items-center justify-center"><div class="flex w-full max-w-sm flex-col items-center justify-center gap-1"><!> <!> <!></div></div>',1);function ka(Fe,Je){Xe(Je,!0);const xe=[],_e=s=>{var i=Mt();i.__click=()=>{if(e(I)===-1)return console.warn("No file to save");const M=y[e(I)];M.time=a.time,M.day=a.day,M.night=a.night,M.current_role=a.current_role,M.roles=a.roles,M.players=a.players.map(ae=>ae.name),localStorage.setItem("werewolf-moderator.slots",JSON.stringify(y)),f(I,-1)};var T=o(i,!0);r(i),x(()=>g(T,p.save_and_quit)),l(s,i)},ue=(s,i=Ee,T=Ee,M,ae)=>{let de=Ue(()=>Ve(M?.(),!0)),be=Ue(()=>Ve(ae?.(),!0));var ge=ce(),D=j(ge);{var C=S=>{var q=Vt(),b=j(q);{var u=d=>{var v=Ht(),c=o(v);{var G=U=>{var Z=Ct();$e(Z),Z.__change=()=>{localStorage.setItem("werewolf-moderator.slots",JSON.stringify(y))},x(()=>oe(Z,"placeholder",`File #${T()+1}`)),ze(Z,()=>i().label,ke=>i().label=ke),l(U,Z)},z=U=>{var Z=Gt(),ke=o(Z,!0);r(Z),x(()=>g(ke,i().label||`File #${T()+1}`)),l(U,Z)};N(c,U=>{e(Y)?U(G):U(z,!1)})}var E=t(c,2);E.__click=()=>{f(Y,!e(Y))};var V=o(E);bt(V,()=>"size-4"),r(E),r(v),l(d,v)},n=d=>{var v=Tt(),c=o(v,!0);r(v),x(()=>g(c,i().label||`File #${T()+1}`)),l(d,v)};N(b,d=>{e(de)?d(u):d(n,!1)})}var m=t(b,2);{var F=d=>{var v=ce(),c=j(v);{var G=E=>{var V=qt(),U=o(V,!0);r(V),x(()=>g(U,p.setup)),l(E,V)},z=E=>{var V=ce(),U=j(V);{var Z=ye=>{var we=zt(),Oe=o(we),Ce=t(Oe);{var Ge=K=>{var re=lt();x(()=>g(re,`(${p.role_names[i().current_role]??""})`)),l(K,re)};N(Ce,K=>{i().current_role&&K(Ge)})}r(we),x(()=>g(Oe,`${p.night??""} #${i().night??""} `)),l(ye,we)},ke=ye=>{var we=ce(),Oe=j(we);{var Ce=K=>{var re=Et(),st=o(re);r(re),x(()=>g(st,`${p.day??""} #${i().day??""}`)),l(K,re)},Ge=K=>{var re=Ut();l(K,re)};N(Oe,K=>{i().time==="day"?K(Ce):K(Ge,!1)},!0)}l(ye,we)};N(U,ye=>{i().time==="night"?ye(Z):ye(ke,!1)},!0)}l(E,V)};N(c,E=>{i().time==="setup"?E(G):E(z,!1)})}l(d,v)};N(m,d=>{e(be)&&d(F)})}var J=t(m,2),h=o(J);r(J);var O=t(J,2),w=o(O);r(O);var L=t(O,2),k=o(L);r(L),x((d,v,c)=>{g(h,`Deck: ${d??""}`),g(w,`${p.roles??""}: ${v??""}`),g(k,`${p.player??""}: ${c??""}`)},[()=>i().deck.map(d=>p[d]).join(", "),()=>i().roles.map(d=>p.role_names[d]).join(", "),()=>i().players.join(", ")]),l(S,q)};N(D,S=>{i()&&S(C)})}l(s,ge)};let Q=P(!1),A=P("loading"),me=P("players");const je=Ae(()=>a.players.some(s=>a.players.some(i=>s.id!==i.id&&s.name===i.name))),Ne=Ae(()=>a.players.some(s=>!s.name));let I=P(-1),X=P(void 0),se=P(-1),fe=P(void 0),H=P(-1),Y=P(!1),ee=P("");function B(){if(e(ee)==="")return;Ie(e(ee))==="loaded"?Se("Imported save state!","success",3e3):Se("Failed to import save state!","error",3e3)}He(()=>Te(()=>{f(I,parseInt(localStorage.getItem("werewolf-moderator.file")??"-1"),!0),wt(localStorage.getItem("werewolf-moderator.slots"));const s=localStorage.getItem("werewolf-moderator");s&&(localStorage.setItem("werewolf-moderator[0]",s),localStorage.removeItem("werewolf-moderator"))})),He(()=>{e(A)!=="loaded"||e(I)===-1||(localStorage.setItem(`werewolf-moderator[${e(I)}]`,xt(a)),Te(()=>Se("Autosaved!","success",1e3)))}),He(()=>{e(I)!==-1?(localStorage.setItem("werewolf-moderator.file",e(I).toString()),f(A,Ie(localStorage.getItem(`werewolf-moderator[${e(I)}]`)),!0),Te(()=>{const s=y[e(I)];s&&(s.time=a.time,s.day=a.day,s.night=a.night,s.current_role=a.current_role,s.roles=a.roles,s.players=a.players.map(i=>i.name),localStorage.setItem("werewolf-moderator.slots",JSON.stringify(y)))})):(localStorage.removeItem("werewolf-moderator.file"),f(A,"loaded"))});var R=oa(),pe=j(R);ct(pe,{get title(){return Ke["werewolf-moderator"]},get description(){return it["werewolf-moderator"]},uri:"werewolf-moderator"});var he=t(pe,2),le=o(he,!0);r(he);var $=t(he,2),W=o($,!0);r($);var De=t($,2),ie=o(De),ne=o(ie);{var Le=s=>{var i=Rt(),T=j(i);{var M=D=>{var C=Zt(),S=j(C);S.__click=()=>{f(Q,!1)};var q=o(S,!0);r(S);var b=t(S,2);mt(b);var u=t(b,4),n=o(u);$e(n),n.value=n.__value="players";var m=t(n,2),F=o(m),J=o(F);tt(J);var h=t(J,4);ft(h);var O=t(h,4);pt(O),r(F),r(m);var w=t(m,2);$e(w),w.value=w.__value="roles";var L=t(w,2),k=o(L),d=o(k);at(d),r(k),r(L),r(u);var v=t(u,2);rt(v);var c=t(v,2);_e(c),x(()=>{S.disabled=e(je)||e(Ne),g(q,p.back),oe(n,"aria-label",p.players),oe(w,"aria-label",p.roles)}),Pe(xe,[],n,()=>e(me),G=>f(me,G)),Pe(xe,[],w,()=>e(me),G=>f(me,G)),l(D,C)},ae=D=>{var C=ce(),S=j(C);{var q=u=>{var n=Bt(),m=j(n);_e(m);var F=t(m,2);Lt(F,{}),l(u,n)},b=u=>{var n=ce(),m=j(n);{var F=h=>{var O=Kt(),w=j(O),L=o(w);L.__click=()=>{a.time="setup"};var k=o(L,!0);r(L);var d=t(L,2);d.__click=()=>{f(Q,!0)};var v=o(d,!0);r(d),r(w);var c=t(w,2);It(c,{}),x(()=>{g(k,p.setup),g(v,p.advanced_settings)}),l(h,O)},J=h=>{var O=ce(),w=j(O);{var L=k=>{var d=Pt(),v=j(d),c=o(v);c.__click=()=>{a.time="setup"};var G=o(c,!0);r(c);var z=t(c,2);z.__click=()=>{f(Q,!0)};var E=o(z,!0);r(z),r(v);var V=t(v,2);$t(V,{});var U=t(V,4);_e(U),x(()=>{g(G,p.setup),g(E,p.advanced_settings)}),l(k,d)};N(w,k=>{a.time==="day"&&k(L)},!0)}l(h,O)};N(m,h=>{a.time==="night"?h(F):h(J,!1)},!0)}l(u,n)};N(S,u=>{a.time==="setup"?u(q):u(b,!1)},!0)}l(D,C)};N(T,D=>{e(Q)?D(M):D(ae,!1)})}var de=t(T,2);ht(de,{});var be=t(de,2);{var ge=D=>{var C=Qt(),S=t(o(C),2);r(C),x(q=>oe(S,"href",q),[()=>dt("/werewolf-moderator/debug/")]),l(D,C)};N(be,D=>{e(A)==="error"&&D(ge)})}l(s,i)},ve=s=>{var i=ra(),T=j(i),M=t(o(T),2),ae=o(M),de=o(ae);qe(de,17,()=>y,Be,(S,q,b)=>{var u=Wt(),n=o(u);ue(n,()=>e(q),()=>b);var m=t(n,4);m.__click=()=>{f(I,b,!0),f(A,"loading"),f(A,Ie(localStorage.getItem(`werewolf-moderator[${e(I)}]`)),!0),f(Q,!1)};var F=t(m,4),J=o(F);J.__click=()=>{e(X)?.showModal(),f(se,b,!0)};var h=t(J,2);h.__pointerup=async()=>{try{const w=localStorage.getItem(`werewolf-moderator[${b+1}]`);if(!w)throw new Error("Save not found");navigator.clipboard.writeText(w),Se("Copied to clipboard!","success",3e3)}catch{Se("Failed to copy to clipboard!","error",15e3)}};var O=o(h,!0);r(h),r(F),r(u),x(()=>g(O,p.copy_save_state_to_clipboard)),l(S,u)});var be=t(de,2),ge=o(be);ge.__click=()=>{f(H,-1),e(fe)?.showModal()},r(be),r(ae),r(M),r(T);var D=t(T,2);Qe(D,{title:"New Game Config",get modal(){return e(fe)},set modal(b){f(fe,b,!0)},body:b=>{var u=ea(),n=o(u),m=o(n);m.value=m.__value=-1;var F=t(m);qe(F,17,()=>({length:y.length}),Be,(k,d,v)=>{var c=Xt(),G=o(c);r(c);var z={};x(()=>{g(G,`Use ${(y[y.length-v-1].label||`File #${y.length-v}`)??""}'s Config`),z!==(z=y.length-v-1)&&(c.value=c.__value=y.length-v-1)}),l(k,c)});var J=t(F);J.value=J.__value=-2,r(n);var h=t(n,2);{var O=k=>{var d=Yt(),v=o(d);$e(v);var c=t(v,2);c.__click=()=>{f(ee,"")};var G=o(c);ot(G),r(c),r(d),x(()=>{oe(v,"placeholder",p.save_state),c.disabled=!e(ee),oe(c,"aria-label",p.clear)}),ze(v,()=>e(ee),z=>f(ee,z)),l(k,d)};N(h,k=>{e(H)===-2&&k(O)})}var w=t(h,2),L=o(w);ue(L,()=>y[e(H)],()=>e(H),()=>!1,()=>!1),r(w),r(u),vt(n,()=>e(H),k=>f(H,k)),l(b,u)},buttons:b=>{var u=ta();u.__click=()=>{if(f(I,y.length,!0),f(A,"loading"),e(H)===-2)B(),y.push({label:"",time:a.time,deck:a.deck,roles:a.roles,players:a.players.map(n=>n.name),night:a.night,current_role:a.current_role,day:a.day});else if(e(H)===-1)f(A,Ie("{}"),!0),y.push({label:"",time:"setup",deck:["msn25","msn24","ultimate"],day:0,night:0,current_role:void 0,roles:["werewolf","villager"],players:["1","2"]});else{const n=St.parse(JSON.parse(localStorage.getItem(`werewolf-moderator[${e(H)+1}]`)??"{}"));Ie("{}"),a.deck=n.deck,a.roles=n.roles,a.players=n.players.map(m=>({id:m.id,name:m.name,alive:!0,role:void 0,score:0})),y.push({label:"",time:"setup",deck:a.deck,roles:a.roles,players:a.players.map(m=>m.name),night:0,current_role:void 0,day:0})}localStorage.setItem("werewolf-moderator.slots",JSON.stringify(y)),f(Q,!1)},l(b,u)},$$slots:{body:!0,buttons:!0}});var C=t(D,2);Qe(C,{title:"Delete?",get modal(){return e(X)},set modal(b){f(X,b,!0)},body:b=>{ue(b,()=>y[e(se)],()=>e(se),()=>!1)},buttons:b=>{var u=aa();u.__click=()=>{for(let n=e(se);n<y.length-1;n+=1){const m=localStorage.getItem(`werewolf-moderator[${n+1}]`);m&&localStorage.setItem(`werewolf-moderator[${n}]`,m)}y.splice(e(se),1),localStorage.setItem("werewolf-moderator.slots",JSON.stringify(y)),e(X)?.close()},l(b,u)},$$slots:{body:!0,buttons:!0}}),l(s,i)};N(ne,s=>{e(I)!==-1?s(Le):s(ve,!1)})}var te=t(ne,2);gt(te,{});var Me=t(te,2);_t(Me,{get status(){return e(A)},get clear_save(){return kt}}),r(ie),r(De),x(()=>{g(le,Ke["werewolf-moderator"]),g(W,nt["werewolf-moderator"])}),l(Fe,R),Ye()}et(["click","change","pointerup"]);export{ka as component};
