import{f as _,a as l,c as _e,t as it}from"../chunks/D2Os11Ns.js";import{p as Ye,s as a,f as j,c as o,r,t as x,g as t,h as Fe,a as et,u as Te,b as qe,i as f,d as W,k as Ue,m as Ve,o as Ze}from"../chunks/CdrH6FGe.js";import{d as tt,s as y,e as Be}from"../chunks/D32HDFMs.js";import{i as N}from"../chunks/C_8Ez5C7.js";import{e as ze,i as Ke}from"../chunks/Dh-GaU7P.js";import{r as $e,s as se,d as nt,n as Pe,v as dt}from"../chunks/B2cvRHtJ.js";import{b as Ee,c as Qe}from"../chunks/C-DQbPxC.js";import{b as vt}from"../chunks/DG713H4s.js";import{r as ct}from"../chunks/C5qBGHmR.js";import{H as _t}from"../chunks/D0zFscOs.js";import{L as ut}from"../chunks/DOUyAul8.js";import{b as at,c as rt,d as ot,i as b,h as mt,x as st,M as Re,a as ft,e as pt,p as bt,f as gt}from"../chunks/D4tuo3Se.js";import{t as Ie,T as yt}from"../chunks/D7WT8dLS.js";import{s as e,n as wt,l as xt,b as p,a as he,d as ht,A as kt,e as St,c as It}from"../chunks/Nrqgik9B.js";import{N as $t,D as jt}from"../chunks/DDB5dnXq.js";import{a as We,d as Nt,f as Dt,b as Ot}from"../chunks/0Vtho8RT.js";import{s as Xe}from"../chunks/B7jqvjGK.js";import{a as Jt}from"../chunks/DxFkQ900.js";var At=_('<div class="col-span-full grid grid-cols-subgrid gap-1"><div class="h-6 w-6"><!></div> <input type="text"/> <button class="btn px-1 btn-sm btn-error"><!></button></div>'),Ft=_('<div class="grid grid-cols-[auto_1fr_auto] items-center justify-center gap-1 rounded border border-primary p-1"><div></div> <div class="text-center"> </div> <div></div> <section class="col-span-full grid grid-cols-subgrid gap-1"></section></div>'),Lt=_('<hr class="my-2 w-full opacity-25"/> <div> </div> <!> <hr class="my-2 w-full opacity-25"/> <!> <hr class="my-2 w-full opacity-25"/> <div class="text-center text-3xl"> </div> <!> <!> <button class="btn btn-primary"> </button>',1);function Mt(Le,Me){Ye(Me,!0);const ke=300,ue=Fe(()=>e.players.some(Q=>e.players.some(ae=>Q.id!==ae.id&&Q.name===ae.name))),me=Fe(()=>e.players.some(Q=>!Q.name));var P=Lt(),J=a(j(P),2),fe=o(J,!0);r(J);var je=a(J,2);at(je);var Ne=a(je,4);{var I=Q=>{var ae=Ft(),be=a(o(ae),2),De=o(be,!0);r(be);var X=a(be,4);ze(X,31,()=>e.players,A=>A.id,(A,Z,Ce)=>{var ie=At(),ne=o(ie),Oe=o(ne);mt(Oe),r(ne),We(ne,q=>Nt?.(q));var de=a(ne,2);$e(de);var ve=a(de,2);ve.__click=()=>{const q=e.players.indexOf(t(Z));q!==-1&&e.players.splice(q,1)};var Je=o(ve);st(Je),r(ve),r(ie),x(q=>{Xe(de,1,`input input-sm ${q??""}`),se(de,"placeholder",`${b.player_name??""}...`),ve.disabled=e.players.length<=2,se(ve,"aria-label",b.remove_player)},[()=>!t(Z).name||e.players.some((q,d)=>d!==t(Ce)&&q.name===t(Z).name)?"input-warning":"input-primary"]),Ee(de,()=>t(Z).name,q=>t(Z).name=q),Jt(ie,()=>Dt,()=>({duration:ke})),l(A,ie)}),r(X),We(X,(A,Z)=>Ot?.(A,Z),()=>({items:e.players,flipDurationMs:ke,transformDraggedElement:A=>{A?.classList.remove("grid-cols-subgrid"),A?.classList.add("grid","grid-cols-[auto_1fr_auto]")}})),r(ae),x(()=>y(De,b.player_name)),Be("consider",X,A=>{e.players=A.detail.items}),Be("finalize",X,A=>{e.players=A.detail.items}),l(Q,ae)};N(Ne,Q=>{e.players.length&&Q(I)})}var Y=a(Ne,4),le=o(Y,!0);r(Y);var pe=a(Y,2);rt(pe);var T=a(pe,2);ot(T);var ee=a(T,2);ee.__click=()=>{e.time="night",e.night===0?wt():e.current_role?e.time="night":e.time="day"};var te=o(ee,!0);r(ee),x(()=>{Xe(J,1,`text-3xl ${t(ue)||t(me)?"text-warning":"text-success"}`),y(fe,b.players),y(le,b.roles),ee.disabled=t(ue)||t(me),y(te,b.start)}),l(Le,P),et()}tt(["click"]);var Ct=_('<button class="btn btn-sm btn-primary"> </button>'),Gt=_('<input class="input input-sm input-primary"/>'),Ht=_('<div class="font-bold"> </div>'),Tt=_('<div class="flex flex-row items-center justify-between gap-4"><!> <button class="btn btn-sm"><!></button></div>'),qt=_('<div class="font-bold"> </div>'),zt=_("<div> </div>"),Et=_("<div> <!></div>"),Ut=_("<div> </div>"),Vt=_("<div></div>"),Zt=_("<!> <!> <div> </div> <div> </div> <div> </div>",1),Bt=_('<button class="btn btn-sm"> </button> <!> <hr class="my-2 w-full opacity-25"/> <div class="tabs-lift tabs w-full"><input type="radio" name="section" class="tab border-b-0! [--tab-border-color:--color-base-content]"/> <div class="tab-content border-base-content bg-base-100 p-4"><div class="flex flex-col items-center justify-center gap-1"><!> <hr class="my-2 w-full opacity-25"/> <!> <hr class="my-2 w-full opacity-25"/> <!></div></div> <input type="radio" name="section" class="tab border-b-0! [--tab-border-color:--color-base-content]"/> <div class="tab-content border-base-content bg-base-100 p-4"><div class="flex flex-col items-center justify-center gap-1"><!></div></div></div> <!> <!>',1),Kt=_("<!> <!>",1),Pt=_('<div class="flex w-full flex-row justify-between"><button class="btn btn-sm"> </button> <button class="btn btn-sm"> </button></div> <!>',1),Qt=_('<div class="flex w-full flex-row justify-between"><button class="btn btn-sm"> </button> <button class="btn btn-sm"> </button></div> <!> <hr class="my-2 w-full opacity-25"/> <!>',1),Rt=_(`<div class="fixed bottom-4 z-50 flex w-full flex-col items-center justify-center gap-1 p-1 text-center"><div>If Link ask you to export save state (or you know how to manually update the save file
						to the latest version), click the link below</div> <a class="link link-primary underline-offset-8">Go to debug page</a></div>`),Wt=_("<!> <!> <!>",1),Xt=_('<div class="flex flex-col border p-4"><!> <hr class="my-2 w-full opacity-25"/> <button class="btn mt-2 w-full btn-primary">Load</button> <hr class="my-2 w-full opacity-25"/> <div class="flex flex-row gap-1"><button class="btn grow btn-sm btn-error">Delete</button> <button class="btn btn-sm"> </button></div></div>'),Yt=_("<option> </option>"),ea=_('<div class="mt-4 flex flex-row gap-1"><input class="input input-sm grow input-primary" type="text"/> <button class="btn px-1 btn-sm btn-error"><!></button></div>'),ta=_('<div class="mt-4 flex flex-col gap-4"><select class="select w-full select-primary"><option>Use Default Config</option><!><option>Import save file</option></select> <!> <div class="flex flex-col gap-1"><!></div></div>'),aa=_('<button class="btn btn-primary">New Game</button>'),ra=_('<button class="btn btn-error">Delete</button>'),oa=_('<div class="relative mt-8 w-full"><div class="flex justify-center"><div class="absolute -top-5 rounded bg-base-100 px-4 pt-4"><div class="rounded border px-4 pb-1 text-3xl font-bold">SAVE DATA</div></div></div> <div class="flex w-full flex-col gap-4 rounded bg-base-100 p-4"><div class="flex flex-col-reverse gap-4 rounded border p-4 pt-10"><!> <div><button class="btn w-full btn-primary">New Game</button></div></div></div></div> <!> <!>',1),sa=_('<!> <div class="text-center text-2xl font-bold"> </div> <div class="text-center"> </div> <div class="m-1 mb-12 flex items-center justify-center"><div class="flex w-full max-w-sm flex-col items-center justify-center gap-1"><!> <!> <!></div></div>',1);function Sa(Le,Me){Ye(Me,!0);const ke=[],ue=d=>{var s=Ct();s.__click=()=>{if(t(I)===-1)return console.warn("No file to save");const C=p[t(I)];C.time=e.time,C.day=e.day,C.night=e.night,C.current_role=e.current_role,C.roles=e.roles,C.players=e.players.map(re=>re.name),localStorage.setItem("werewolf-moderator.slots",JSON.stringify(p)),f(I,-1)};var $=o(s,!0);r(s),x(()=>y($,b.save_and_quit)),l(d,s)},me=(d,s=Ue,$=Ue,C,re)=>{let ce=Ve(()=>Ze(C?.(),!0)),ge=Ve(()=>Ze(re?.(),!0));var ye=_e(),D=j(ye);{var G=S=>{var z=Zt(),g=j(z);{var u=v=>{var n=Tt(),c=o(n);{var H=V=>{var K=Gt();$e(K),K.__change=()=>{localStorage.setItem("werewolf-moderator.slots",JSON.stringify(p))},x(()=>se(K,"placeholder",`File #${$()+1}`)),Ee(K,()=>s().label,Se=>s().label=Se),l(V,K)},E=V=>{var K=Ht(),Se=o(K,!0);r(K),x(()=>y(Se,s().label||`File #${$()+1}`)),l(V,K)};N(c,V=>{t(ee)?V(H):V(E,!1)})}var U=a(c,2);U.__click=()=>{f(ee,!t(ee))};var B=o(U);gt(B,()=>"size-4"),r(U),r(n),l(v,n)},i=v=>{var n=qt(),c=o(n,!0);r(n),x(()=>y(c,s().label||`File #${$()+1}`)),l(v,n)};N(g,v=>{t(ce)?v(u):v(i,!1)})}var m=a(g,2);{var F=v=>{var n=_e(),c=j(n);{var H=U=>{var B=zt(),V=o(B,!0);r(B),x(()=>y(V,b.setup)),l(U,B)},E=U=>{var B=_e(),V=j(B);{var K=we=>{var xe=Et(),Ae=o(xe),Ge=a(Ae);{var He=R=>{var oe=it();x(()=>y(oe,`(${b.role_names[s().current_role]??""})`)),l(R,oe)};N(Ge,R=>{s().current_role&&R(He)})}r(xe),x(()=>y(Ae,`${b.night??""} #${s().night??""} `)),l(we,xe)},Se=we=>{var xe=_e(),Ae=j(xe);{var Ge=R=>{var oe=Ut(),lt=o(oe);r(oe),x(()=>y(lt,`${b.day??""} #${s().day??""}`)),l(R,oe)},He=R=>{var oe=Vt();l(R,oe)};N(Ae,R=>{s().time==="day"?R(Ge):R(He,!1)},!0)}l(we,xe)};N(V,we=>{s().time==="night"?we(K):we(Se,!1)},!0)}l(U,B)};N(c,U=>{s().time==="setup"?U(H):U(E,!1)})}l(v,n)};N(m,v=>{t(ge)&&v(F)})}var L=a(m,2),h=o(L);r(L);var O=a(L,2),w=o(O);r(O);var M=a(O,2),k=o(M);r(M),x((v,n,c)=>{y(h,`Deck: ${v??""}`),y(w,`${b.roles??""}: ${n??""}`),y(k,`${b.player??""}: ${c??""}`)},[()=>s().deck.map(v=>b[v]).join(", "),()=>s().roles.map(v=>b.role_names[v]).join(", "),()=>s().players.join(", ")]),l(S,z)};N(D,S=>{s()&&S(G)})}l(d,ye)};let P=W(!1),J=W("loading"),fe=W("players");const je=Fe(()=>e.players.some(d=>e.players.some(s=>d.id!==s.id&&d.name===s.name))),Ne=Fe(()=>e.players.some(d=>!d.name));let I=W(-1),Y=W(void 0),le=W(-1),pe=W(void 0),T=W(-1),ee=W(!1),te=W("");function Q(){if(t(te)==="")return;he(t(te))==="loaded"?Ie("Imported save state!","success",3e3):Ie("Failed to import save state!","error",3e3)}Te(()=>qe(()=>{f(I,parseInt(localStorage.getItem("werewolf-moderator.file")??"-1"),!0),xt(localStorage.getItem("werewolf-moderator.slots")),ae("werewolf-moderator")}));function ae(d){const s=localStorage.getItem(d);if(s){localStorage.setItem(`werewolf-moderator[${p.length}]`,s);try{he(s),p.push({label:"",time:e.time,deck:e.deck,roles:e.roles,players:e.players.map($=>$.name),night:e.night,current_role:e.current_role,day:e.day})}catch($){console.log($),p.push({label:"",time:"setup",deck:[],roles:[],players:[],night:0,current_role:void 0,day:0})}finally{localStorage.setItem("werewolf-moderator.slots",JSON.stringify(p)),f(P,!1),localStorage.removeItem(d)}}}Te(()=>{t(J)!=="loaded"||t(I)===-1||(localStorage.setItem(`werewolf-moderator[${t(I)}]`,ht(e)),qe(()=>Ie("Autosaved!","success",1e3)))}),Te(()=>{t(I)!==-1?(localStorage.setItem("werewolf-moderator.file",t(I).toString()),f(J,he(localStorage.getItem(`werewolf-moderator[${t(I)}]`)),!0),qe(()=>{const d=p[t(I)];d&&(d.time=e.time,d.deck=e.deck,d.roles=e.roles,d.players=e.players.map(s=>s.name),d.night=e.night,d.current_role=e.current_role,d.day=e.day,localStorage.setItem("werewolf-moderator.slots",JSON.stringify(p)))})):(localStorage.removeItem("werewolf-moderator.file"),f(J,"loaded"))});var be=sa(),De=j(be);_t(De,{get title(){return Pe["werewolf-moderator"]},get description(){return nt["werewolf-moderator"]},uri:"werewolf-moderator"});var X=a(De,2),A=o(X,!0);r(X);var Z=a(X,2),Ce=o(Z,!0);r(Z);var ie=a(Z,2),ne=o(ie),Oe=o(ne);{var de=d=>{var s=Wt(),$=j(s);{var C=D=>{var G=Bt(),S=j(G);S.__click=()=>{f(P,!1)};var z=o(S,!0);r(S);var g=a(S,2);ft(g);var u=a(g,4),i=o(u);$e(i),i.value=i.__value="players";var m=a(i,2),F=o(m),L=o(F);at(L);var h=a(L,4);pt(h);var O=a(h,4);bt(O),r(F),r(m);var w=a(m,2);$e(w),w.value=w.__value="roles";var M=a(w,2),k=o(M),v=o(k);rt(v),r(k),r(M),r(u);var n=a(u,2);ot(n);var c=a(n,2);ue(c),x(()=>{S.disabled=t(je)||t(Ne),y(z,b.back),se(i,"aria-label",b.players),se(w,"aria-label",b.roles)}),Qe(ke,[],i,()=>t(fe),H=>f(fe,H)),Qe(ke,[],w,()=>t(fe),H=>f(fe,H)),l(D,G)},re=D=>{var G=_e(),S=j(G);{var z=u=>{var i=Kt(),m=j(i);ue(m);var F=a(m,2);Mt(F,{}),l(u,i)},g=u=>{var i=_e(),m=j(i);{var F=h=>{var O=Pt(),w=j(O),M=o(w);M.__click=()=>{e.time="setup"};var k=o(M,!0);r(M);var v=a(M,2);v.__click=()=>{f(P,!0)};var n=o(v,!0);r(v),r(w);var c=a(w,2);$t(c,{}),x(()=>{y(k,b.setup),y(n,b.advanced_settings)}),l(h,O)},L=h=>{var O=_e(),w=j(O);{var M=k=>{var v=Qt(),n=j(v),c=o(n);c.__click=()=>{e.time="setup"};var H=o(c,!0);r(c);var E=a(c,2);E.__click=()=>{f(P,!0)};var U=o(E,!0);r(E),r(n);var B=a(n,2);jt(B,{});var V=a(B,4);ue(V),x(()=>{y(H,b.setup),y(U,b.advanced_settings)}),l(k,v)};N(w,k=>{e.time==="day"&&k(M)},!0)}l(h,O)};N(m,h=>{e.time==="night"?h(F):h(L,!1)},!0)}l(u,i)};N(S,u=>{e.time==="setup"?u(z):u(g,!1)},!0)}l(D,G)};N($,D=>{t(P)?D(C):D(re,!1)})}var ce=a($,2);kt(ce,{});var ge=a(ce,2);{var ye=D=>{var G=Rt(),S=a(o(G),2);r(G),x(z=>se(S,"href",z),[()=>ct("/werewolf-moderator/debug/")]),l(D,G)};N(ge,D=>{t(J)==="error"&&D(ye)})}l(d,s)},ve=d=>{var s=oa(),$=j(s),C=a(o($),2),re=o(C),ce=o(re);ze(ce,17,()=>p,Ke,(S,z,g)=>{var u=Xt(),i=o(u);me(i,()=>t(z),()=>g);var m=a(i,4);m.__click=()=>{f(I,g,!0),f(J,"loading"),f(J,he(localStorage.getItem(`werewolf-moderator[${t(I)}]`)),!0),f(P,!1)};var F=a(m,4),L=o(F);L.__click=()=>{t(Y)?.showModal(),f(le,g,!0)};var h=a(L,2);h.__pointerup=async()=>{try{const w=localStorage.getItem(`werewolf-moderator[${g}]`);if(!w)throw new Error("Save not found");navigator.clipboard.writeText(w),Ie("Copied to clipboard!","success",3e3)}catch{Ie("Failed to copy to clipboard!","error",15e3)}};var O=o(h,!0);r(h),r(F),r(u),x(()=>y(O,b.copy_save_state_to_clipboard)),l(S,u)});var ge=a(ce,2),ye=o(ge);ye.__click=()=>{f(T,-1),t(pe)?.showModal()},r(ge),r(re),r(C),r($);var D=a($,2);Re(D,{title:"New Game Config",get modal(){return t(pe)},set modal(g){f(pe,g,!0)},body:g=>{var u=ta(),i=o(u),m=o(i);m.value=m.__value=-1;var F=a(m);ze(F,17,()=>({length:p.length}),Ke,(k,v,n)=>{var c=Yt(),H=o(c);r(c);var E={};x(()=>{y(H,`Use ${(p[p.length-n-1].label||`File #${p.length-n}`)??""}'s Config`),E!==(E=p.length-n-1)&&(c.value=c.__value=p.length-n-1)}),l(k,c)});var L=a(F);L.value=L.__value=-2,r(i);var h=a(i,2);{var O=k=>{var v=ea(),n=o(v);$e(n);var c=a(n,2);c.__click=()=>{f(te,"")};var H=o(c);st(H),r(c),r(v),x(()=>{se(n,"placeholder",b.save_state),c.disabled=!t(te),se(c,"aria-label",b.clear)}),Ee(n,()=>t(te),E=>f(te,E)),l(k,v)};N(h,k=>{t(T)===-2&&k(O)})}var w=a(h,2),M=o(w);me(M,()=>p[t(T)],()=>t(T),()=>!1,()=>!1),r(w),r(u),vt(i,()=>t(T),k=>f(T,k)),l(g,u)},buttons:g=>{var u=aa();u.__click=()=>{if(f(I,p.length,!0),f(J,"loading"),t(T)===-2)Q(),p.push({label:"",time:e.time,deck:e.deck,roles:e.roles,players:e.players.map(i=>i.name),night:e.night,current_role:e.current_role,day:e.day});else if(t(T)===-1)f(J,he("{}"),!0),p.push({label:"",time:"setup",deck:["msn25","msn24","ultimate"],day:0,night:0,current_role:void 0,roles:["werewolf","villager"],players:["1","2"]});else{const i=It.parse(JSON.parse(localStorage.getItem(`werewolf-moderator[${t(T)+1}]`)??"{}"));he("{}"),e.deck=i.deck,e.roles=i.roles,e.players=i.players.map(m=>({id:m.id,name:m.name,alive:!0,role:void 0,score:0})),p.push({label:"",time:"setup",deck:e.deck,roles:e.roles,players:e.players.map(m=>m.name),night:0,current_role:void 0,day:0})}localStorage.setItem("werewolf-moderator.slots",JSON.stringify(p)),f(P,!1)},l(g,u)},$$slots:{body:!0,buttons:!0}});var G=a(D,2);Re(G,{title:"Delete?",get modal(){return t(Y)},set modal(g){f(Y,g,!0)},body:g=>{me(g,()=>p[t(le)],()=>t(le),()=>!1)},buttons:g=>{var u=ra();u.__click=()=>{for(let i=t(le);i<p.length-1;i+=1){const m=localStorage.getItem(`werewolf-moderator[${i+1}]`);m&&localStorage.setItem(`werewolf-moderator[${i}]`,m)}p.splice(t(le),1),localStorage.setItem("werewolf-moderator.slots",JSON.stringify(p)),t(Y)?.close()},l(g,u)},$$slots:{body:!0,buttons:!0}}),l(d,s)};N(Oe,d=>{t(I)!==-1?d(de):d(ve,!1)})}var Je=a(Oe,2);yt(Je,{});var q=a(Je,2);ut(q,{get status(){return t(J)},get clear_save(){return St}}),r(ne),r(ie),x(()=>{y(A,Pe["werewolf-moderator"]),y(Ce,dt["werewolf-moderator"])}),l(Le,be),et()}tt(["click","change","pointerup"]);export{Sa as component};
