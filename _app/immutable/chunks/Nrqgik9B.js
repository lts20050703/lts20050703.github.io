import{e as K,p as X,u as Y,b as Z,a as ee,g as f,h as P}from"./CdrH6FGe.js";import{_ as p,o as y,h as l,b,n as i,l as C,a as o,p as L,t as T,e as le,c as E,s as D}from"./zY0APpH_.js";import"./D2Os11Ns.js";const re=["villager"],q=["villager","drunk","doppelganger","cursed","cupid_24","cupid","night_guard_25","werewolf","acolyte_of_death_25","big_bad_wolf","dire_wolf","fruit_brute","immortal_wolf_25","lone_wolf","voodoo_wolf_25","wolf_cub","wolf_prince_25","wolverine","minion","lycan","vampire","witch_25","witch_24","witch","apprentice_seer","seer_25","seer_24","seer","bodyguard_24","bodyguard","cult_leader_24","cult_leader","diseased_24","diseased","detective_25","executioner_25","ghost","grave_robber_24","hoodlum","hunter_24","hunter_25","hunter","idiot","inspector_25","mad_bomber_24","mad_bomber_25","martyr","mason","mayor","old_hag","pacifist","police_25","sage_24","soul_24","spellcaster","tanner","tough_guy","bodyguard_25","cult_leader_25","journalist_25"],N=p(q),te=["acolyte_of_death_25","big_bad_wolf","dire_wolf","fruit_brute","immortal_wolf_25","lone_wolf","wolf_cub","wolf_prince_25","wolverine","minion","lycan","diseased","diseased_24","ghost","hoodlum","idiot","mad_bomber_24","martyr","mason","mayor","pacifist","soul_24","sage_24","tanner","tough_guy"],B=["werewolf","acolyte_of_death_25","big_bad_wolf","dire_wolf","fruit_brute","immortal_wolf_25","lone_wolf","voodoo_wolf_25","wolf_cub","wolf_prince_25","wolverine"],J=[...B,"minion"],ke=["cult_leader_24","cult_leader","hoodlum","sage_24","tanner","vampire"],xe=["cursed","doppelganger","drunk"],je=q.filter(_=>_.endsWith("_25")),Ae=["villager","werewolf","mason","grave_robber_24"],Oe=q.filter(_=>_.endsWith("_24")),Ne=["cursed","villager","werewolf","wolf_cub","vampire","old_hag"],_e=["apprentice_seer_switched","bodyguard_24_saved_2","bodyguard_25_saved_2","cult_leader_25_saved","cursed_werewolf","doppelganger_switched","fruit_brute_only_alive","hunter_24_killed_villager","hunter_25_killed_villager","inspector_25_killed","inspector_25_revealed","mad_bomber_25_planted_all","seer_target_all_werewolves","soul_24_killed_by_villager","soul_24_killed_by_werewolf","witch_24_killed","witch_24_saved","witch_24_used_third","witch_killed","witch_saved","acolyte_of_death_25_is_last_wolf","bodyguard_25_solved","couple_24_died","cult_leader_25_solved","inspector_25_killed_today","inspector_25_revealed_today","journalist_25_solved","mad_bomber_25_detonated","mad_bomber_25_detonated_target","mad_bomber_25_target_died","seer_25_charged_today","seer_25_used_today","villager_killed_diseased_24","werewolf_killed_diseased_24","werewolf_killed_diseased","witch_25_cooked_today","witch_25_used_today","wolf_cub_died","wolf_prince_died","wolverine_nearest_targets","all_role_players_dead","big_bad_wolf_alive","bodyguard_25_no_solve","bodyguard_25_no_target","journalist_25_no_target","mad_bomber_25_1_per_night","mad_bomber_25_cannot_plant","mad_bomber_25_cannot_move","seer_25_not_enough_powers","seer_25_used_all_powers","seer_25_used_free","witch_24_select_third_potion","witch_25_max_1_save_potion","witch_25_max_3_potions","witch_25_used_all_kills","witch_25_used_all_saves","wolf_prince_alive"],F=p(_e),Se=["acolyte_of_death_25_is_last_wolf","bodyguard_25_solved","couple_24_died","cult_leader_25_solved","inspector_25_killed_today","inspector_25_revealed_today","journalist_25_solved","mad_bomber_25_detonated","mad_bomber_25_detonated_target","mad_bomber_25_target_died","seer_25_charged_today","seer_25_used_today","villager_killed_diseased_24","werewolf_killed_diseased_24","werewolf_killed_diseased","witch_25_cooked_today","witch_25_used_today","wolf_cub_died","wolf_prince_died","wolverine_nearest_targets"],qe=["immortal_wolf_25","cupid_24","cupid","dire_wolf","doppelganger","hoodlum","hunter","sage_24"],H=["acolyte_of_death_25","couple_24","couple","cult_leader_24","dire_wolf","ghost","hang","hunter_24","hunter_25","hunter","inspector_25","mad_bomber_24","mad_bomber_25","police_25_werewolf","spellcaster","tough_guy","vampire","voodoo_wolf_25_right","voodoo_wolf_25_wrong","werewolf","witch_24","witch_25","witch"],oe=["bodyguard_24","bodyguard_25","bodyguard","cult_leader_25","cursed","dice_10","dice_4","executioner_25_untie","horcrux_25","kicked","msn25","police_25","police_25_at_home","police_25_at_target","tough_guy","witch_24","witch_25","witch"],ie=["2","3","4","5","6","7","8","9","10","11","12"],G={villager_werewolf_win_alive:5,villager_werewolf_win_dead:3,third_party_win:7,cupid_couple_win:2,witch_kill_werewolf:1,bodyguard_save_villager:1,hunter_kill_werewolf:1,seer_target_werewolf_third_party:1,seer_target_all_werewolves:3,wolf_cub_villager_hang:1,cult_leader_cult_alive:1,cult_leader_cult_dead:-1},se=y({sage_24:b(p(["villager","werewolf"])),executioner_25:b(p(["tie","untie"])),bodyguard_24:l(o(i()),[]),bodyguard_25:l(o(i()),[]),bodyguard:l(o(i()),[]),cult_leader_25:l(o(i()),[]),cult_leader_24:l(o(i()),[]),cult_leader:l(o(i()),[]),cupid_24:l(o(i()),[]),cupid:l(o(i()),[]),detective_25:l(o(i()),[]),dire_wolf:l(o(i()),[]),hoodlum:l(o(i()),[]),hunter_24:l(o(i()),[]),hunter_25:l(o(i()),[]),hunter:l(o(i()),[]),immortal_wolf_25:l(o(i()),[]),journalist_25:l(o(i()),[]),night_guard_25:l(o(i()),[]),old_hag:l(o(i()),[]),police_25:l(o(i()),[]),seer_24:l(o(i()),[]),seer:l(o(i()),[]),spellcaster:l(o(i()),[]),vampire:l(o(i()),[]),werewolf:l(o(i()),[]),voodoo_wolf_25:l(y({id:l(o(i()),[]),role:l(o(L(T(_=>_??void 0),b(N))),[])}),{}),doppelganger:l(y({id:l(o(i()),[]),role:l(o(N),[])}),{}),inspector_25:l(y({kill:l(o(i()),[]),reveal:l(o(i()),[])}),{}),mad_bomber_25:l(y({old:l(o(i()),[]),new:l(o(i()),[]),bombs:l(i(),3)}),{}),witch:l(y({save:l(o(i()),[]),kill:l(o(i()),[])}),{}),witch_24:l(y({save:l(o(i()),[]),kill:l(o(i()),[]),third:l(o(i()),[]),potion:b(p(["save","kill"]))}),{}),witch_25:l(y({save:l(o(i()),[]),kill:l(o(i()),[]),cook:b(p(["save","kill"])),save_potions:l(i(),0),kill_potions:l(i(),0)}),{}),seer_25:l(y({id:l(o(i()),[]),use:l(i(),0),charge:b(C(!0)),power:l(i(),0)}),{})}),Q=y({time:l(p(["setup","night","day"]),"setup"),lang:l(p(["en","vn","dual"]),"vn"),deck:l(o(p(["msn25","msn24","ultimate"])),["msn25","msn24","ultimate"]),roles:l(o(N),["werewolf","villager"]),players:l(o(y({id:i(),name:D(),alive:E(),role:b(N),score:l(i(),0)})),[{id:1,name:"1",alive:!0,score:0},{id:2,name:"2",alive:!0,score:0}]),night:l(i(),0),current_role:b(N),targets:l(o(se),[{}]),flags:L(T(_=>Array.isArray(_)?_.filter(t=>F.safeParse(t).success):[]),o(F)),day:l(i(),0),solved:l(E(),!1),kill_feed:l(o(o(y({id:i(),died:E(),reasons:o(y({kill:p(H),saves:o(p(oe)),cult_leader_25:b(C(!0))}))}))),[]),score_feed:l(o(o(y({id:i(),reason:p(Object.keys(G)),old:i(),new:i()}))),[]),role_feed:l(o(o(y({id:i(),old:b(N),new:b(N)}))),[[]]),kill_queue:l(o(y({id:i(),kill_reason:p(H),time:p(["day","night"]),day:i(),cult_leader_25:b(C(!0))})),[]),dices:l(o(le(p(ie))),[]),win:l(o(p(["couple_24","couple","cult_leader_24","cult_leader","hoodlum","lone_wolf","sage_24","soul_24","tanner","villager","werewolf"])),[]),cult_leader_25:l(o(y({id:i(),lr:b(p(["left","right"])),distance:i(),left:i(),right:i()})),[])}),e=K(Q.parse({})),R=o(y({label:l(D(),""),time:l(p(["setup","night","day"]),"setup"),deck:l(o(p(["msn25","msn24","ultimate"])),["msn25","msn24","ultimate"]),roles:l(o(N),["werewolf","villager"]),players:l(o(D()),["1","2"]),night:l(i(),0),current_role:b(N),day:l(i(),0)})),ne=K(R.parse([])),ae=["/werewolf-moderator/wolverine.mp3"];let S;const M=[];async function de(_){const t=M.findIndex(n=>n.src===_),r=M[t];if(r){if(r.started){const n=r.node.buffer;r.node.stop(),r.node.disconnect(),r.node=new AudioBufferSourceNode(S,{buffer:n}),r.node.connect(r.gain).connect(S.destination)}r.node.start(0),r.started=!0}}function Be(_,t){X(t,!0),Y(()=>Z(()=>{(async()=>(S=new AudioContext,await Promise.all(ae.map(async r=>{const n=await S.decodeAudioData(await(await fetch(r)).arrayBuffer()),g=new AudioBufferSourceNode(S,{buffer:n}),a=new GainNode(S);g.connect(a).connect(S.destination),M.push({node:g,gain:a,started:!1,src:r})}))))()})),ee()}function Ie(){let _=0,t=0;for(const r of e.players)r.alive&&(_+=1,r.role&&J.includes(r.role)&&(t+=1));return{alive:_,werewolf_alive:t}}const h=P(()=>e.targets[e.targets.length-1]),ce=P(()=>f(h).werewolf);function ue(){if(!e.roles.includes("wolverine")||!e.players.some(t=>t.alive&&t.role==="wolverine")||!e.players.some(t=>t.alive&&t.role&&B.includes(t.role)))return;let _=!1;for(let t=0;t<e.players.length;t+=1){if(!f(ce).includes(e.players[t].id))continue;let r=(t-1+e.players.length)%e.players.length,n=(t+1)%e.players.length;for(;;){for(;!e.players[r].alive;)r=(r-1+e.players.length)%e.players.length;for(;!e.players[n].alive;)n=(n+1)%e.players.length;const g=e.players[r].role,a=e.players[n].role;if(g==="wolverine"||a==="wolverine"){_=!0;break}if(g&&B.includes(g)||a&&B.includes(a))break;r=(r-1+e.players.length)%e.players.length,n=(n+1)%e.players.length}}_&&(c("wolverine_nearest_targets"),de("/werewolf-moderator/wolverine.mp3"))}function Je(_,t,r){if(!e.roles.includes("journalist_25"))return{};const n=e.players.filter(d=>t.some(m=>m.id===_.id&&m.reasons.some(W=>d.role&&(W.kill==="police_25_werewolf"?f(h).police_25.includes(d.id):W.kill==="werewolf"?B.includes(d.role):W.kill.startsWith(d.role))))||r.some(m=>m.id===_.id&&d.role&&(m.kill_reason==="police_25_werewolf"?f(h).police_25.includes(d.id):m.kill_reason==="werewolf"?B.includes(d.role):m.kill_reason.startsWith(d.role))));if(!n.length)return{};const g=n.every(d=>!d.alive),a=n.some(d=>t.some(m=>m.id===d.id&&m.died)),u=g&&a,s=g&&!a;let w=!1,v=!1;const I=e.players.findIndex(d=>d.id===_.id);let x=(I-1+e.players.length)%e.players.length,O=(I+1)%e.players.length,j=e.players[x],k=e.players[O],z=0;for(;;){for(;(!j.alive||t.some(d=>d.id===j.id&&d.died))&&!(n.some(d=>d.id===j.id)&&(t.some(m=>m.id===j.id&&m.died)&&u||!j.alive&&s));)x=(x-1+e.players.length)%e.players.length,j=e.players[x];for(;(!k.alive||t.some(d=>d.id===k.id&&d.died))&&!(n.some(d=>d.id===k.id)&&(t.some(m=>m.id===k.id&&m.died)&&u||!k.alive&&s));)O=(O+1)%e.players.length,k=e.players[O];if(z+=1,n.some(d=>d.id===j.id)&&(w=!0),n.some(d=>d.id===k.id)&&(v=!0),w||v)return{is_left:w,is_right:v,distance:z,all_kilers_dead:g};x=(x-1+e.players.length)%e.players.length,O=(O+1)%e.players.length,j=e.players[x],k=e.players[O]}}function We(_){if(!e.roles.includes("cult_leader_25"))return{};const t=e.targets.map(w=>w.cult_leader_25).flat();if(!t.some(w=>e.players.find(v=>v.id===w)?.alive))return{};let r=!1,n=!1;const g=e.players.findIndex(w=>w.id===_.id);let a=(g-1+e.players.length)%e.players.length,u=(g+1)%e.players.length,s=0;for(;;){for(;!e.players[a].alive;)a=(a-1+e.players.length)%e.players.length;for(;!e.players[u].alive;)u=(u+1)%e.players.length;s+=1;const w=e.players[a],v=e.players[u];if(t.includes(w.id)&&(r=!0),t.includes(v.id)&&(n=!0),r||n)return{is_left:r,is_right:n,left_index:a,right_index:u,distance:s};a=(a-1+e.players.length)%e.players.length,u=(u+1)%e.players.length}}function fe(_){for(let t=_;t>=0;t-=1){const r=e.dices[t];if(r!=="9")return r??"null"}return"null"}function Ee(_,t,r=1){e.score_feed[e.score_feed.length-1]?.push({id:_.id,reason:t,old:_.score,new:_.score+G[t]*r}),_.score+=G[t]*r}const he=P(()=>e.role_feed[e.role_feed.length-1]);function Ce(_=!1){e.players.filter(s=>f(h).hunter_24.includes(s.id)).some(s=>s.role&&!J.includes(s.role))&&c("hunter_24_killed_villager"),e.players.filter(s=>f(h).hunter_25.includes(s.id)).some(s=>s.role&&!J.includes(s.role))&&c("hunter_25_killed_villager"),f(h).witch.kill.length&&c("witch_killed"),f(h).witch.save.length&&c("witch_saved"),f(h).witch_24.kill.length&&c("witch_24_killed"),f(h).witch_24.save.length&&c("witch_24_saved"),f(h).witch_24.third.length&&c("witch_24_used_third");const n=f(h).witch_25.save_potions+(f(h).witch_25.cook==="save"?1:0)-f(h).witch_25.save.length,g=f(h).witch_25.kill_potions+(f(h).witch_25.cook==="kill"?1:0)-f(h).witch_25.kill.length;n>=1?(A("witch_25_used_all_saves"),c("witch_25_max_1_save_potion")):(A("witch_25_max_1_save_potion"),c("witch_25_used_all_saves")),g>=1?A("witch_25_used_all_kills"):c("witch_25_used_all_kills"),g+n>=3?c("witch_25_max_3_potions"):A("witch_25_max_3_potions"),f(h).seer_25.power+(f(h).seer_25.charge?1:0)-f(h).seer_25.use-Math.max(0,f(h).seer_25.id.length-1)<2?c("seer_25_not_enough_powers"):A("seer_25_not_enough_powers");const u=e.players.filter(s=>s.role&&J.includes(s.role)&&s.alive);if(e.roles.includes("bodyguard_25")&&f(h).bodyguard_25.length>1&&c("bodyguard_25_saved_2"),e.roles.includes("bodyguard_24")&&f(h).bodyguard_24.length>1&&c("bodyguard_24_saved_2"),e.roles.includes("fruit_brute")&&u.length&&u.every(s=>s.role==="fruit_brute")&&c("fruit_brute_only_alive"),e.roles.includes("acolyte_of_death_25")&&u.length&&u.every(s=>s.role==="acolyte_of_death_25")&&(u.forEach(s=>{f(he).push({id:s.id,old:s.role,new:"werewolf"}),s.role="werewolf"}),c("acolyte_of_death_25_is_last_wolf")),e.roles.includes("big_bad_wolf")&&!u.some(s=>s.role==="big_bad_wolf")&&A("big_bad_wolf_alive"),e.roles.includes("wolf_prince_25")&&!u.some(s=>s.role==="wolf_prince_25")&&A("wolf_prince_alive"),e.roles.includes("cupid_24")&&e.players.filter(w=>f(h).cupid_24.includes(w.id)).every(w=>!w.alive)&&c("couple_24_died"),!_&&e.roles.includes("inspector_25")){const s=e.targets[e.targets.length-2]?.inspector_25;s?.kill.length&&c("inspector_25_killed"),s?.reveal.length&&c("inspector_25_revealed")}ue()}function De(){location.href="./new/"}function ge(){e.time="day",e.day+=1,e.solved=!1}function Ge(){if(fe(e.dices.length-1)==="2"){const _=e.role_feed[e.role_feed.length-1];for(const t of e.players)t.alive&&(_.push({id:t.id,old:t.role,new:void 0}),t.role=void 0)}e.time="night",e.night+=1,ve(),e.night===1&&(e.roles.includes("big_bad_wolf")&&c("big_bad_wolf_alive"),e.roles.includes("seer_25")&&c("seer_25_used_all_powers"),e.roles.includes("witch_25")&&c(["witch_25_used_all_saves","witch_25_used_all_kills"])),e.night===4&&e.roles.includes("wolf_prince_25")&&e.players.some(_=>_.role==="wolf_prince_25"&&_.alive)&&c("wolf_prince_alive"),U()}function Me(){e.time="night",e.day-=1,pe(),e.solved=!0,U()}function U(){e.roles.includes("journalist_25")&&(e.night<2?c("journalist_25_no_target"):A("journalist_25_no_target")),e.roles.includes("bodyguard_25")&&(e.night<3?c(["bodyguard_25_no_solve","bodyguard_25_no_target"]):e.night===3?A(["bodyguard_25_no_solve","bodyguard_25_no_target"]):(A("bodyguard_25_no_target"),c("bodyguard_25_no_solve")))}function we(){e.time="day",e.night-=1}function pe(){V(-1),!e.current_role&&(e.night===1?(e.night=0,e.time="setup"):we())}function ve(){V(1),!e.current_role&&ge()}function V(_){let t=0;for(e.current_role?t=q.indexOf(e.current_role):_>0?t=-1:t=q.length;t+=_,e.current_role=q[t],!(!re.includes(e.current_role)&&!(e.night!==1&&te.includes(e.current_role)&&e.dices[e.dices.length-1]!=="2")&&!(e.night!==3&&e.current_role==="drunk")&&!(e.dices.includes("12")&&!e.players.some(r=>r.role===e.current_role&&r.alive))&&(!e.current_role||e.roles.includes(e.current_role))););}function Pe(_,t){if(!_)return"loaded";try{for(const[r,n]of Object.entries(Q.parse(JSON.parse(_))))e[r]=n;return"loaded"}catch(r){if(console.log(r),t)throw r;return"error"}}function $e(_){return JSON.stringify(_,(t,r)=>{switch(t){case"targets":{if(!Array.isArray(r))return r;const n=[];for(const g of r){const a=g;if(!a||typeof a!="object"){n.push(a);continue}const u={};for(const[s,w]of Object.entries(a)){const v=w;if(typeof v=="string"){u[s]=v;continue}if(Array.isArray(v)){v.length&&(u[s]=v);continue}if(v!==null&&typeof v=="object"){let I=0;const x={};for(const[O,j]of Object.entries(v)){const k=j;(!Array.isArray(k)||k.length)&&(x[O]=k,I+=1)}I&&(u[s]=x)}}n.push(u)}return n}case"players":{if(!Array.isArray(r))return r;const n=[];for(const g of r){const a=g;if(!a||typeof a!="object"){n.push(a);continue}const u={};for(const[s,w]of Object.entries(a)){const v=w;s==="score"&&w===0||(u[s]=v)}n.push(u)}return n}default:return r}})}function ze(_,t){if(!_)return"loaded";try{for(const[r,n]of Object.entries(R.parse(JSON.parse(_))))ne[r]=n;return"loaded"}catch(r){return console.log(r),"error"}}function Fe(_){return _.replaceAll(`
`,"<br>").replaceAll("<>",'<span class="text-base-content/50">').replaceAll("</>","</span>").replaceAll("<!>",'<span class="text-warning">').replaceAll("</!>","</span>")}function He(){setTimeout(()=>{this.selectionStart=this.selectionEnd=this.value.length},0)}function c(_,t){if(!($()&&!t)){typeof _=="string"&&(_=[_]);for(const r of _)e.flags.includes(r)||e.flags.push(r)}}function A(_,t){$()&&!t||(typeof _=="string"&&(_=[_]),e.flags=e.flags.filter(r=>!_.includes(r)))}function Ke(_,t,r,n,{force_wet_run:g,cult_leader_25:a}={}){e.kill_queue.push({id:_,time:r,kill_reason:t,day:$()&&!g?-1:n,cult_leader_25:a})}function $(){return e.current_role==="bodyguard_25"||e.current_role==="journalist_25"||e.current_role==="cult_leader_25"}export{Be as A,c as B,We as C,$ as D,A as E,Se as F,Ie as G,Ce as H,ie as I,Je as J,qe as K,fe as L,pe as M,ve as N,Pe as a,ne as b,Q as c,$e as d,De as e,Ae as f,re as g,He as h,Oe as i,Ne as j,ge as k,ze as l,je as m,Ge as n,ke as o,we as p,xe as q,q as r,e as s,Me as t,se as u,Fe as v,J as w,B as x,Ke as y,Ee as z};
